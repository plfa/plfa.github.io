<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Untyped: Untyped lambda calculus with full normalisation | Programming Language Foundations in Agda</title><meta name="generator" content="Jekyll v3.9.0"><meta property="og:title" content="Untyped: Untyped lambda calculus with full normalisation"><meta property="og:locale" content="en_US"><meta name="description" content="Programming Language Foundations in Agda"><meta property="og:description" content="Programming Language Foundations in Agda"><link rel="canonical" href="https://plfa.github.io/19.08/Untyped/"><meta property="og:url" content="https://plfa.github.io/19.08/Untyped/"><meta property="og:site_name" content="Programming Language Foundations in Agda"><script type="application/ld+json">{"url":"https://plfa.github.io/19.08/Untyped/","headline":"Untyped: Untyped lambda calculus with full normalisation","description":"Programming Language Foundations in Agda","@type":"WebPage","@context":"https://schema.org"}</script><link rel="stylesheet" href="/19.08/assets/main.css"></head><body><header class="site-header" role="banner"><div class="wrapper"><a class="site-title" href="/19.08/">Programming Language Foundations in Agda</a><nav class="site-nav"><span class="menu-icon"><svg viewBox="0 0 18 15" width="18px" height="15px"><path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/><path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/><path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/></svg></span><div class="trigger"><a class="page-link" href="/19.08/">The Book</a> <a class="page-link" href="/19.08/Announcements/">Announcements</a> <a class="page-link" href="/19.08/GettingStarted/">Getting Started</a> <a class="page-link" href="/19.08/Citing/">Citing</a> <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a></div></nav></div></header><main class="page-content" aria-label="Content"><div class="wrapper"><article class="post"><header class="post-header"><h1 class="post-title">Untyped: Untyped lambda calculus with full normalisation</h1></header><p style="text-align:center"><a alt="Previous chapter" href="/19.08/Inference/">Prev</a> &bullet; <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev-19.08/src/plfa/part2/Untyped.lagda.md">Source</a> &bullet; <a alt="Next chapter" href="/19.08/Confluence/">Next</a></p><div class="post-content"><pre class="Agda"><a id="173" class="Keyword">module</a> <a id="180" href="/19.08/Untyped/" class="Module">plfa.part2.Untyped</a> <a id="199" class="Keyword">where</a>
</pre><p>In this chapter we play with variations on a theme:</p><ul><li><p>Previous chapters consider intrinsically-typed calculi; here we consider one that is untyped but intrinsically scoped.</p></li><li><p>Previous chapters consider call-by-value calculi; here we consider call-by-name.</p></li><li><p>Previous chapters consider <em>weak head normal form</em>, where reduction stops at a lambda abstraction; here we consider <em>full normalisation</em>, where reduction continues underneath a lambda.</p></li><li><p>Previous chapters consider <em>deterministic</em> reduction, where there is at most one redex in a given term; here we consider <em>non-deterministic</em> reduction where a term may contain many redexes and any one of them may reduce.</p></li><li><p>Previous chapters consider reduction of <em>closed</em> terms, those with no free variables; here we consider <em>open</em> terms, those which may have free variables.</p></li><li><p>Previous chapters consider lambda calculus extended with natural numbers and fixpoints; here we consider a tiny calculus with just variables, abstraction, and application, in which the other constructs may be encoded.</p></li></ul><p>In general, one may mix and match these features, save that full normalisation requires open terms and encoding naturals and fixpoints requires being untyped. The aim of this chapter is to give some appreciation for the range of different lambda calculi one may encounter.</p><h2 id="imports">Imports</h2><pre class="Agda"><a id="1580" class="Keyword">import</a> <a id="1587" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1625" class="Symbol">as</a> <a id="1628" class="Module">Eq</a>
<a id="1631" class="Keyword">open</a> <a id="1636" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="1639" class="Keyword">using</a> <a id="1645" class="Symbol">(</a><a id="1646" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="1649" class="Symbol">;</a> <a id="1651" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1655" class="Symbol">;</a> <a id="1657" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1660" class="Symbol">;</a> <a id="1662" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#984" class="Function">trans</a><a id="1667" class="Symbol">;</a> <a id="1669" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1673" class="Symbol">)</a>
<a id="1675" class="Keyword">open</a> <a id="1680" class="Keyword">import</a> <a id="1687" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="1698" class="Keyword">using</a> <a id="1704" class="Symbol">(</a><a id="1705" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#279" class="Datatype">⊥</a><a id="1706" class="Symbol">;</a> <a id="1708" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a><a id="1714" class="Symbol">)</a>
<a id="1716" class="Keyword">open</a> <a id="1721" class="Keyword">import</a> <a id="1728" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.html" class="Module">Data.Nat</a> <a id="1737" class="Keyword">using</a> <a id="1743" class="Symbol">(</a><a id="1744" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="1745" class="Symbol">;</a> <a id="1747" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="1751" class="Symbol">;</a> <a id="1753" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a><a id="1756" class="Symbol">;</a> <a id="1758" href="Agda.Builtin.Nat.html#298" class="Primitive Operator">_+_</a><a id="1761" class="Symbol">;</a> <a id="1763" href="Agda.Builtin.Nat.html#388" class="Primitive Operator">_∸_</a><a id="1766" class="Symbol">)</a>
<a id="1768" class="Keyword">open</a> <a id="1773" class="Keyword">import</a> <a id="1780" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1793" class="Keyword">using</a> <a id="1799" class="Symbol">(</a><a id="1800" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="1803" class="Symbol">)</a> <a id="1805" class="Keyword">renaming</a> <a id="1814" class="Symbol">(</a><a id="1815" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1819" class="Symbol">to</a> <a id="1822" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1827" class="Symbol">)</a>
<a id="1829" class="Keyword">open</a> <a id="1834" class="Keyword">import</a> <a id="1841" href="https://agda.github.io/agda-stdlib/v1.1/Data.Unit.html" class="Module">Data.Unit</a> <a id="1851" class="Keyword">using</a> <a id="1857" class="Symbol">(</a><a id="1858" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a><a id="1859" class="Symbol">;</a> <a id="1861" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a><a id="1863" class="Symbol">)</a>
<a id="1865" class="Keyword">open</a> <a id="1870" class="Keyword">import</a> <a id="1877" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="1886" class="Keyword">using</a> <a id="1892" class="Symbol">(</a><a id="1893" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="1896" class="Symbol">)</a>
<a id="1898" class="Keyword">open</a> <a id="1903" class="Keyword">import</a> <a id="1910" href="https://agda.github.io/agda-stdlib/v1.1/Function.Equivalence.html" class="Module">Function.Equivalence</a> <a id="1931" class="Keyword">using</a> <a id="1937" class="Symbol">(</a><a id="1938" href="https://agda.github.io/agda-stdlib/v1.1/Function.Equivalence.html#971" class="Function Operator">_⇔_</a><a id="1941" class="Symbol">;</a> <a id="1943" href="https://agda.github.io/agda-stdlib/v1.1/Function.Equivalence.html#1064" class="Function">equivalence</a><a id="1954" class="Symbol">)</a>
<a id="1956" class="Keyword">open</a> <a id="1961" class="Keyword">import</a> <a id="1968" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1985" class="Keyword">using</a> <a id="1991" class="Symbol">(</a><a id="1992" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬_</a><a id="1994" class="Symbol">;</a> <a id="1996" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="1999" class="Symbol">;</a> <a id="2001" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="2004" class="Symbol">;</a> <a id="2006" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="2008" class="Symbol">)</a>
<a id="2010" class="Keyword">open</a> <a id="2015" class="Keyword">import</a> <a id="2022" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="2049" class="Keyword">using</a> <a id="2055" class="Symbol">(</a><a id="2056" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Decidable.html#982" class="Function">map</a><a id="2059" class="Symbol">)</a>
<a id="2061" class="Keyword">open</a> <a id="2066" class="Keyword">import</a> <a id="2073" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="2099" class="Keyword">using</a> <a id="2105" class="Symbol">(</a><a id="2106" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html#880" class="Function">contraposition</a><a id="2120" class="Symbol">)</a>
<a id="2122" class="Keyword">open</a> <a id="2127" class="Keyword">import</a> <a id="2134" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Product.html" class="Module">Relation.Nullary.Product</a> <a id="2159" class="Keyword">using</a> <a id="2165" class="Symbol">(</a><a id="2166" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Product.html#585" class="Function Operator">_×-dec_</a><a id="2173" class="Symbol">)</a>
</pre><h2 id="untyped-is-uni-typed">Untyped is Uni-typed</h2><p>Our development will be close to that in Chapter <a href="/19.08/DeBruijn/">DeBruijn</a>, save that every term will have exactly the same type, written <code class="language-plaintext highlighter-rouge">★</code> and pronounced “any”. This matches a slogan introduced by Dana Scott and echoed by Robert Harper: “Untyped is Uni-typed”. One consequence of this approach is that constructs which previously had to be given separately (such as natural numbers and fixpoints) can now be defined in the language itself.</p><h2 id="syntax">Syntax</h2><p>First, we get all our infix declarations out of the way:</p><pre class="Agda"><a id="2739" class="Keyword">infix</a>  <a id="2746" class="Number">4</a>  <a id="2749" href="/19.08/Untyped/#4294" class="Datatype Operator">_⊢_</a>
<a id="2753" class="Keyword">infix</a>  <a id="2760" class="Number">4</a>  <a id="2763" href="/19.08/Untyped/#3521" class="Datatype Operator">_∋_</a>
<a id="2767" class="Keyword">infixl</a> <a id="2774" class="Number">5</a>  <a id="2777" href="/19.08/Untyped/#3191" class="InductiveConstructor Operator">_,_</a>

<a id="2782" class="Keyword">infix</a>  <a id="2789" class="Number">6</a>  <a id="2792" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ_</a>
<a id="2795" class="Keyword">infix</a>  <a id="2802" class="Number">6</a>  <a id="2805" href="/19.08/Untyped/#8531" class="InductiveConstructor Operator">′_</a>
<a id="2808" class="Keyword">infixl</a> <a id="2815" class="Number">7</a>  <a id="2818" href="/19.08/Untyped/#4442" class="InductiveConstructor Operator">_·_</a>
</pre><h2 id="types">Types</h2><p>We have just one type:</p><pre class="Agda"><a id="2864" class="Keyword">data</a> <a id="Type"></a><a id="2869" href="/19.08/Untyped/#2869" class="Datatype">Type</a> <a id="2874" class="Symbol">:</a> <a id="2876" class="PrimitiveType">Set</a> <a id="2880" class="Keyword">where</a>
  <a id="Type.★"></a><a id="2888" href="/19.08/Untyped/#2888" class="InductiveConstructor">★</a> <a id="2890" class="Symbol">:</a> <a id="2892" href="plfa.part2.Untyped.html#2869" class="Datatype">Type</a>
</pre><h4 id="exercise-type-practice">Exercise (<code class="language-plaintext highlighter-rouge">Type≃⊤</code>) (practice)</h4><p>Show that <code class="language-plaintext highlighter-rouge">Type</code> is isomorphic to <code class="language-plaintext highlighter-rouge">⊤</code>, the unit type.</p><pre class="Agda"><a id="2998" class="Comment">-- Your code goes here</a>
</pre><h2 id="contexts">Contexts</h2><p>As before, a context is a list of types, with the type of the most recently bound variable on the right:</p><pre class="Agda"><a id="3148" class="Keyword">data</a> <a id="Context"></a><a id="3153" href="/19.08/Untyped/#3153" class="Datatype">Context</a> <a id="3161" class="Symbol">:</a> <a id="3163" class="PrimitiveType">Set</a> <a id="3167" class="Keyword">where</a>
  <a id="Context.∅"></a><a id="3175" href="/19.08/Untyped/#3175" class="InductiveConstructor">∅</a>   <a id="3179" class="Symbol">:</a> <a id="3181" href="plfa.part2.Untyped.html#3153" class="Datatype">Context</a>
  <a id="Context._,_"></a><a id="3191" href="/19.08/Untyped/#3191" class="InductiveConstructor Operator">_,_</a> <a id="3195" class="Symbol">:</a> <a id="3197" href="plfa.part2.Untyped.html#3153" class="Datatype">Context</a> <a id="3205" class="Symbol">→</a> <a id="3207" href="plfa.part2.Untyped.html#2869" class="Datatype">Type</a> <a id="3212" class="Symbol">→</a> <a id="3214" href="plfa.part2.Untyped.html#3153" class="Datatype">Context</a>
</pre><p>We let <code class="language-plaintext highlighter-rouge">Γ</code> and <code class="language-plaintext highlighter-rouge">Δ</code> range over contexts.</p><h4 id="exercise-contextℕ-practice">Exercise (<code class="language-plaintext highlighter-rouge">Context≃ℕ</code>) (practice)</h4><p>Show that <code class="language-plaintext highlighter-rouge">Context</code> is isomorphic to <code class="language-plaintext highlighter-rouge">ℕ</code>.</p><pre class="Agda"><a id="3354" class="Comment">-- Your code goes here</a>
</pre><h2 id="variables-and-the-lookup-judgment">Variables and the lookup judgment</h2><p>Intrinsically-scoped variables correspond to the lookup judgment. The rules are as before:</p><pre class="Agda"><a id="3516" class="Keyword">data</a> <a id="_∋_"></a><a id="3521" href="/19.08/Untyped/#3521" class="Datatype Operator">_∋_</a> <a id="3525" class="Symbol">:</a> <a id="3527" href="plfa.part2.Untyped.html#3153" class="Datatype">Context</a> <a id="3535" class="Symbol">→</a> <a id="3537" href="plfa.part2.Untyped.html#2869" class="Datatype">Type</a> <a id="3542" class="Symbol">→</a> <a id="3544" class="PrimitiveType">Set</a> <a id="3548" class="Keyword">where</a>

  <a id="_∋_.Z"></a><a id="3557" href="/19.08/Untyped/#3557" class="InductiveConstructor">Z</a> <a id="3559" class="Symbol">:</a> <a id="3561" class="Symbol">∀</a> <a id="3563" class="Symbol">{</a><a id="3564" href="plfa.part2.Untyped.html#3564" class="Bound">Γ</a> <a id="3566" href="plfa.part2.Untyped.html#3566" class="Bound">A</a><a id="3567" class="Symbol">}</a>
     <a id="3574" class="Comment">---------</a>
   <a id="3587" class="Symbol">→</a> <a id="3589" href="/19.08/Untyped/#3564" class="Bound">Γ</a> <a id="3591" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="3593" href="plfa.part2.Untyped.html#3566" class="Bound">A</a> <a id="3595" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="3597" href="plfa.part2.Untyped.html#3566" class="Bound">A</a>

  <a id="_∋_.S_"></a><a id="3602" href="/19.08/Untyped/#3602" class="InductiveConstructor Operator">S_</a> <a id="3605" class="Symbol">:</a> <a id="3607" class="Symbol">∀</a> <a id="3609" class="Symbol">{</a><a id="3610" href="plfa.part2.Untyped.html#3610" class="Bound">Γ</a> <a id="3612" href="plfa.part2.Untyped.html#3612" class="Bound">A</a> <a id="3614" href="plfa.part2.Untyped.html#3614" class="Bound">B</a><a id="3615" class="Symbol">}</a>
    <a id="3621" class="Symbol">→</a> <a id="3623" href="/19.08/Untyped/#3610" class="Bound">Γ</a> <a id="3625" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="3627" href="plfa.part2.Untyped.html#3612" class="Bound">A</a>
      <a id="3635" class="Comment">---------</a>
    <a id="3649" class="Symbol">→</a> <a id="3651" href="/19.08/Untyped/#3610" class="Bound">Γ</a> <a id="3653" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="3655" href="plfa.part2.Untyped.html#3614" class="Bound">B</a> <a id="3657" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="3659" href="plfa.part2.Untyped.html#3612" class="Bound">A</a>
</pre><p>We could write the rules with all instances of <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> replaced by <code class="language-plaintext highlighter-rouge">★</code>, but arguably it is clearer not to do so.</p><p>Because <code class="language-plaintext highlighter-rouge">★</code> is the only type, the judgment doesn’t guarantee anything useful about types. But it does ensure that all variables are in scope. For instance, we cannot use <code class="language-plaintext highlighter-rouge">S S Z</code> in a context that only binds two variables.</p><h2 id="terms-and-the-scoping-judgment">Terms and the scoping judgment</h2><p>Intrinsically-scoped terms correspond to the typing judgment, but with <code class="language-plaintext highlighter-rouge">★</code> as the only type. The result is that we check that terms are well scoped — that is, that all variables they mention are in scope — but not that they are well typed:</p><pre class="Agda"><a id="4289" class="Keyword">data</a> <a id="_⊢_"></a><a id="4294" href="/19.08/Untyped/#4294" class="Datatype Operator">_⊢_</a> <a id="4298" class="Symbol">:</a> <a id="4300" href="plfa.part2.Untyped.html#3153" class="Datatype">Context</a> <a id="4308" class="Symbol">→</a> <a id="4310" href="plfa.part2.Untyped.html#2869" class="Datatype">Type</a> <a id="4315" class="Symbol">→</a> <a id="4317" class="PrimitiveType">Set</a> <a id="4321" class="Keyword">where</a>

  <a id="_⊢_.`_"></a><a id="4330" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`_</a> <a id="4333" class="Symbol">:</a> <a id="4335" class="Symbol">∀</a> <a id="4337" class="Symbol">{</a><a id="4338" href="plfa.part2.Untyped.html#4338" class="Bound">Γ</a> <a id="4340" href="plfa.part2.Untyped.html#4340" class="Bound">A</a><a id="4341" class="Symbol">}</a>
    <a id="4347" class="Symbol">→</a> <a id="4349" href="/19.08/Untyped/#4338" class="Bound">Γ</a> <a id="4351" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="4353" href="plfa.part2.Untyped.html#4340" class="Bound">A</a>
      <a id="4361" class="Comment">-----</a>
    <a id="4371" class="Symbol">→</a> <a id="4373" href="/19.08/Untyped/#4338" class="Bound">Γ</a> <a id="4375" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="4377" href="plfa.part2.Untyped.html#4340" class="Bound">A</a>

  <a id="_⊢_.ƛ_"></a><a id="4382" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ_</a>  <a id="4386" class="Symbol">:</a>  <a id="4389" class="Symbol">∀</a> <a id="4391" class="Symbol">{</a><a id="4392" href="plfa.part2.Untyped.html#4392" class="Bound">Γ</a><a id="4393" class="Symbol">}</a>
    <a id="4399" class="Symbol">→</a> <a id="4401" href="/19.08/Untyped/#4392" class="Bound">Γ</a> <a id="4403" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="4405" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="4407" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="4409" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
      <a id="4417" class="Comment">---------</a>
    <a id="4431" class="Symbol">→</a> <a id="4433" href="/19.08/Untyped/#4392" class="Bound">Γ</a> <a id="4435" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="4437" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>

  <a id="_⊢_._·_"></a><a id="4442" href="/19.08/Untyped/#4442" class="InductiveConstructor Operator">_·_</a> <a id="4446" class="Symbol">:</a> <a id="4448" class="Symbol">∀</a> <a id="4450" class="Symbol">{</a><a id="4451" href="plfa.part2.Untyped.html#4451" class="Bound">Γ</a><a id="4452" class="Symbol">}</a>
    <a id="4458" class="Symbol">→</a> <a id="4460" href="/19.08/Untyped/#4451" class="Bound">Γ</a> <a id="4462" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="4464" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
    <a id="4470" class="Symbol">→</a> <a id="4472" href="/19.08/Untyped/#4451" class="Bound">Γ</a> <a id="4474" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="4476" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
      <a id="4484" class="Comment">------</a>
    <a id="4495" class="Symbol">→</a> <a id="4497" href="/19.08/Untyped/#4451" class="Bound">Γ</a> <a id="4499" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="4501" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
</pre><p>Now we have a tiny calculus, with only variables, abstraction, and application. Below we will see how to encode naturals and fixpoints into this calculus.</p><h2 id="writing-variables-as-numerals">Writing variables as numerals</h2><p>As before, we can convert a natural to the corresponding de Bruijn index. We no longer need to lookup the type in the context, since every variable has the same type:</p><pre class="Agda"><a id="count"></a><a id="4870" href="/19.08/Untyped/#4870" class="Function">count</a> <a id="4876" class="Symbol">:</a> <a id="4878" class="Symbol">∀</a> <a id="4880" class="Symbol">{</a><a id="4881" href="plfa.part2.Untyped.html#4881" class="Bound">Γ</a><a id="4882" class="Symbol">}</a> <a id="4884" class="Symbol">→</a> <a id="4886" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="4888" class="Symbol">→</a> <a id="4890" href="plfa.part2.Untyped.html#4881" class="Bound">Γ</a> <a id="4892" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="4894" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="4896" href="/19.08/Untyped/#4870" class="Function">count</a> <a id="4902" class="Symbol">{</a><a id="4903" href="plfa.part2.Untyped.html#4903" class="Bound">Γ</a> <a id="4905" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="4907" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="4908" class="Symbol">}</a> <a id="4910" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a>     <a id="4919" class="Symbol">=</a>  <a id="4922" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a>
<a id="4924" href="/19.08/Untyped/#4870" class="Function">count</a> <a id="4930" class="Symbol">{</a><a id="4931" href="plfa.part2.Untyped.html#4931" class="Bound">Γ</a> <a id="4933" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="4935" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="4936" class="Symbol">}</a> <a id="4938" class="Symbol">(</a><a id="4939" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="4943" href="plfa.part2.Untyped.html#4943" class="Bound">n</a><a id="4944" class="Symbol">)</a>  <a id="4947" class="Symbol">=</a>  <a id="4950" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="4952" class="Symbol">(</a><a id="4953" href="plfa.part2.Untyped.html#4870" class="Function">count</a> <a id="4959" href="plfa.part2.Untyped.html#4943" class="Bound">n</a><a id="4960" class="Symbol">)</a>
<a id="4962" href="/19.08/Untyped/#4870" class="Function">count</a> <a id="4968" class="Symbol">{</a><a id="4969" href="plfa.part2.Untyped.html#3175" class="InductiveConstructor">∅</a><a id="4970" class="Symbol">}</a>     <a id="4976" class="Symbol">_</a>        <a id="4985" class="Symbol">=</a>  <a id="4988" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="4995" href="plfa.part2.Untyped.html#5024" class="Postulate">impossible</a>
  <a id="5008" class="Keyword">where</a> <a id="5014" class="Keyword">postulate</a> <a id="5024" href="/19.08/Untyped/#5024" class="Postulate">impossible</a> <a id="5035" class="Symbol">:</a> <a id="5037" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#279" class="Datatype">⊥</a>
</pre><p>We can then introduce a convenient abbreviation for variables:</p><pre class="Agda"><a id="#_"></a><a id="5111" href="/19.08/Untyped/#5111" class="Function Operator">#_</a> <a id="5114" class="Symbol">:</a> <a id="5116" class="Symbol">∀</a> <a id="5118" class="Symbol">{</a><a id="5119" href="plfa.part2.Untyped.html#5119" class="Bound">Γ</a><a id="5120" class="Symbol">}</a> <a id="5122" class="Symbol">→</a> <a id="5124" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="5126" class="Symbol">→</a> <a id="5128" href="plfa.part2.Untyped.html#5119" class="Bound">Γ</a> <a id="5130" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="5132" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="5134" href="/19.08/Untyped/#5111" class="Function Operator">#</a> <a id="5136" href="plfa.part2.Untyped.html#5136" class="Bound">n</a>  <a id="5139" class="Symbol">=</a>  <a id="5142" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="5144" href="plfa.part2.Untyped.html#4870" class="Function">count</a> <a id="5150" href="plfa.part2.Untyped.html#5136" class="Bound">n</a>
</pre><h2 id="test-examples">Test examples</h2><p>Our only example is computing two plus two on Church numerals:</p><pre class="Agda"><a id="twoᶜ"></a><a id="5242" href="/19.08/Untyped/#5242" class="Function">twoᶜ</a> <a id="5247" class="Symbol">:</a> <a id="5249" class="Symbol">∀</a> <a id="5251" class="Symbol">{</a><a id="5252" href="plfa.part2.Untyped.html#5252" class="Bound">Γ</a><a id="5253" class="Symbol">}</a> <a id="5255" class="Symbol">→</a> <a id="5257" href="plfa.part2.Untyped.html#5252" class="Bound">Γ</a> <a id="5259" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="5261" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="5263" href="/19.08/Untyped/#5242" class="Function">twoᶜ</a> <a id="5268" class="Symbol">=</a> <a id="5270" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5272" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5274" class="Symbol">(</a><a id="5275" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5277" class="Number">1</a> <a id="5279" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5281" class="Symbol">(</a><a id="5282" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5284" class="Number">1</a> <a id="5286" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5288" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5290" class="Number">0</a><a id="5291" class="Symbol">))</a>

<a id="fourᶜ"></a><a id="5295" href="/19.08/Untyped/#5295" class="Function">fourᶜ</a> <a id="5301" class="Symbol">:</a> <a id="5303" class="Symbol">∀</a> <a id="5305" class="Symbol">{</a><a id="5306" href="plfa.part2.Untyped.html#5306" class="Bound">Γ</a><a id="5307" class="Symbol">}</a> <a id="5309" class="Symbol">→</a> <a id="5311" href="plfa.part2.Untyped.html#5306" class="Bound">Γ</a> <a id="5313" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="5315" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="5317" href="/19.08/Untyped/#5295" class="Function">fourᶜ</a> <a id="5323" class="Symbol">=</a> <a id="5325" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5327" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5329" class="Symbol">(</a><a id="5330" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5332" class="Number">1</a> <a id="5334" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5336" class="Symbol">(</a><a id="5337" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5339" class="Number">1</a> <a id="5341" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5343" class="Symbol">(</a><a id="5344" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5346" class="Number">1</a> <a id="5348" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5350" class="Symbol">(</a><a id="5351" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5353" class="Number">1</a> <a id="5355" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5357" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5359" class="Number">0</a><a id="5360" class="Symbol">))))</a>

<a id="plusᶜ"></a><a id="5366" href="/19.08/Untyped/#5366" class="Function">plusᶜ</a> <a id="5372" class="Symbol">:</a> <a id="5374" class="Symbol">∀</a> <a id="5376" class="Symbol">{</a><a id="5377" href="plfa.part2.Untyped.html#5377" class="Bound">Γ</a><a id="5378" class="Symbol">}</a> <a id="5380" class="Symbol">→</a> <a id="5382" href="plfa.part2.Untyped.html#5377" class="Bound">Γ</a> <a id="5384" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="5386" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="5388" href="/19.08/Untyped/#5366" class="Function">plusᶜ</a> <a id="5394" class="Symbol">=</a> <a id="5396" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5398" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5400" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5402" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="5404" class="Symbol">(</a><a id="5405" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5407" class="Number">3</a> <a id="5409" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5411" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5413" class="Number">1</a> <a id="5415" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5417" class="Symbol">(</a><a id="5418" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5420" class="Number">2</a> <a id="5422" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5424" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5426" class="Number">1</a> <a id="5428" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5430" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="5432" class="Number">0</a><a id="5433" class="Symbol">))</a>

<a id="2+2ᶜ"></a><a id="5437" href="/19.08/Untyped/#5437" class="Function">2+2ᶜ</a> <a id="5442" class="Symbol">:</a> <a id="5444" href="plfa.part2.Untyped.html#3175" class="InductiveConstructor">∅</a> <a id="5446" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="5448" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="5450" href="/19.08/Untyped/#5437" class="Function">2+2ᶜ</a> <a id="5455" class="Symbol">=</a> <a id="5457" href="plfa.part2.Untyped.html#5366" class="Function">plusᶜ</a> <a id="5463" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5465" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="5470" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="5472" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a>
</pre><p>Before, reduction stopped when we reached a lambda term, so we had to compute <code class="language-plaintext highlighter-rouge">plusᶜ · twoᶜ · twoᶜ · sucᶜ · `zero</code> to ensure we reduced to a representation of the natural four. Now, reduction continues under lambda, so we don’t need the extra arguments. It is convenient to define a term to represent four as a Church numeral, as well as two.</p><h2 id="renaming">Renaming</h2><p>Our definition of renaming is as before. First, we need an extension lemma:</p><pre class="Agda"><a id="ext"></a><a id="5925" href="/19.08/Untyped/#5925" class="Function">ext</a> <a id="5929" class="Symbol">:</a> <a id="5931" class="Symbol">∀</a> <a id="5933" class="Symbol">{</a><a id="5934" href="plfa.part2.Untyped.html#5934" class="Bound">Γ</a> <a id="5936" href="plfa.part2.Untyped.html#5936" class="Bound">Δ</a><a id="5937" class="Symbol">}</a> <a id="5939" class="Symbol">→</a> <a id="5941" class="Symbol">(∀</a> <a id="5944" class="Symbol">{</a><a id="5945" href="plfa.part2.Untyped.html#5945" class="Bound">A</a><a id="5946" class="Symbol">}</a> <a id="5948" class="Symbol">→</a> <a id="5950" href="plfa.part2.Untyped.html#5934" class="Bound">Γ</a> <a id="5952" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="5954" href="plfa.part2.Untyped.html#5945" class="Bound">A</a> <a id="5956" class="Symbol">→</a> <a id="5958" href="plfa.part2.Untyped.html#5936" class="Bound">Δ</a> <a id="5960" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="5962" href="plfa.part2.Untyped.html#5945" class="Bound">A</a><a id="5963" class="Symbol">)</a>
    <a id="5969" class="Comment">-----------------------------------</a>
  <a id="6007" class="Symbol">→</a> <a id="6009" class="Symbol">(∀</a> <a id="6012" class="Symbol">{</a><a id="6013" href="/19.08/Untyped/#6013" class="Bound">A</a> <a id="6015" href="plfa.part2.Untyped.html#6015" class="Bound">B</a><a id="6016" class="Symbol">}</a> <a id="6018" class="Symbol">→</a> <a id="6020" href="plfa.part2.Untyped.html#5934" class="Bound">Γ</a> <a id="6022" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="6024" href="plfa.part2.Untyped.html#6015" class="Bound">B</a> <a id="6026" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6028" href="plfa.part2.Untyped.html#6013" class="Bound">A</a> <a id="6030" class="Symbol">→</a> <a id="6032" href="plfa.part2.Untyped.html#5936" class="Bound">Δ</a> <a id="6034" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="6036" href="plfa.part2.Untyped.html#6015" class="Bound">B</a> <a id="6038" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6040" href="plfa.part2.Untyped.html#6013" class="Bound">A</a><a id="6041" class="Symbol">)</a>
<a id="6043" href="/19.08/Untyped/#5925" class="Function">ext</a> <a id="6047" href="plfa.part2.Untyped.html#6047" class="Bound">ρ</a> <a id="6049" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a>      <a id="6056" class="Symbol">=</a>  <a id="6059" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a>
<a id="6061" href="/19.08/Untyped/#5925" class="Function">ext</a> <a id="6065" href="plfa.part2.Untyped.html#6065" class="Bound">ρ</a> <a id="6067" class="Symbol">(</a><a id="6068" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="6070" href="plfa.part2.Untyped.html#6070" class="Bound">x</a><a id="6071" class="Symbol">)</a>  <a id="6074" class="Symbol">=</a>  <a id="6077" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="6079" class="Symbol">(</a><a id="6080" href="plfa.part2.Untyped.html#6065" class="Bound">ρ</a> <a id="6082" href="plfa.part2.Untyped.html#6070" class="Bound">x</a><a id="6083" class="Symbol">)</a>
</pre><p>We could replace all instances of <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> by <code class="language-plaintext highlighter-rouge">★</code>, but arguably it is clearer not to do so.</p><p>Now it is straightforward to define renaming:</p><pre class="Agda"><a id="rename"></a><a id="6235" href="/19.08/Untyped/#6235" class="Function">rename</a> <a id="6242" class="Symbol">:</a> <a id="6244" class="Symbol">∀</a> <a id="6246" class="Symbol">{</a><a id="6247" href="plfa.part2.Untyped.html#6247" class="Bound">Γ</a> <a id="6249" href="plfa.part2.Untyped.html#6249" class="Bound">Δ</a><a id="6250" class="Symbol">}</a>
  <a id="6254" class="Symbol">→</a> <a id="6256" class="Symbol">(∀</a> <a id="6259" class="Symbol">{</a><a id="6260" href="/19.08/Untyped/#6260" class="Bound">A</a><a id="6261" class="Symbol">}</a> <a id="6263" class="Symbol">→</a> <a id="6265" href="plfa.part2.Untyped.html#6247" class="Bound">Γ</a> <a id="6267" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6269" href="plfa.part2.Untyped.html#6260" class="Bound">A</a> <a id="6271" class="Symbol">→</a> <a id="6273" href="plfa.part2.Untyped.html#6249" class="Bound">Δ</a> <a id="6275" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6277" href="plfa.part2.Untyped.html#6260" class="Bound">A</a><a id="6278" class="Symbol">)</a>
    <a id="6284" class="Comment">------------------------</a>
  <a id="6311" class="Symbol">→</a> <a id="6313" class="Symbol">(∀</a> <a id="6316" class="Symbol">{</a><a id="6317" href="/19.08/Untyped/#6317" class="Bound">A</a><a id="6318" class="Symbol">}</a> <a id="6320" class="Symbol">→</a> <a id="6322" href="plfa.part2.Untyped.html#6247" class="Bound">Γ</a> <a id="6324" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="6326" href="plfa.part2.Untyped.html#6317" class="Bound">A</a> <a id="6328" class="Symbol">→</a> <a id="6330" href="plfa.part2.Untyped.html#6249" class="Bound">Δ</a> <a id="6332" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="6334" href="plfa.part2.Untyped.html#6317" class="Bound">A</a><a id="6335" class="Symbol">)</a>
<a id="6337" href="/19.08/Untyped/#6235" class="Function">rename</a> <a id="6344" href="plfa.part2.Untyped.html#6344" class="Bound">ρ</a> <a id="6346" class="Symbol">(</a><a id="6347" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="6349" href="plfa.part2.Untyped.html#6349" class="Bound">x</a><a id="6350" class="Symbol">)</a>          <a id="6361" class="Symbol">=</a>  <a id="6364" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="6366" class="Symbol">(</a><a id="6367" href="plfa.part2.Untyped.html#6344" class="Bound">ρ</a> <a id="6369" href="plfa.part2.Untyped.html#6349" class="Bound">x</a><a id="6370" class="Symbol">)</a>
<a id="6372" href="/19.08/Untyped/#6235" class="Function">rename</a> <a id="6379" href="plfa.part2.Untyped.html#6379" class="Bound">ρ</a> <a id="6381" class="Symbol">(</a><a id="6382" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="6384" href="plfa.part2.Untyped.html#6384" class="Bound">N</a><a id="6385" class="Symbol">)</a>          <a id="6396" class="Symbol">=</a>  <a id="6399" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="6401" class="Symbol">(</a><a id="6402" href="plfa.part2.Untyped.html#6235" class="Function">rename</a> <a id="6409" class="Symbol">(</a><a id="6410" href="plfa.part2.Untyped.html#5925" class="Function">ext</a> <a id="6414" href="plfa.part2.Untyped.html#6379" class="Bound">ρ</a><a id="6415" class="Symbol">)</a> <a id="6417" href="plfa.part2.Untyped.html#6384" class="Bound">N</a><a id="6418" class="Symbol">)</a>
<a id="6420" href="/19.08/Untyped/#6235" class="Function">rename</a> <a id="6427" href="plfa.part2.Untyped.html#6427" class="Bound">ρ</a> <a id="6429" class="Symbol">(</a><a id="6430" href="plfa.part2.Untyped.html#6430" class="Bound">L</a> <a id="6432" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="6434" href="plfa.part2.Untyped.html#6434" class="Bound">M</a><a id="6435" class="Symbol">)</a>        <a id="6444" class="Symbol">=</a>  <a id="6447" class="Symbol">(</a><a id="6448" href="plfa.part2.Untyped.html#6235" class="Function">rename</a> <a id="6455" href="plfa.part2.Untyped.html#6427" class="Bound">ρ</a> <a id="6457" href="plfa.part2.Untyped.html#6430" class="Bound">L</a><a id="6458" class="Symbol">)</a> <a id="6460" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="6462" class="Symbol">(</a><a id="6463" href="plfa.part2.Untyped.html#6235" class="Function">rename</a> <a id="6470" href="plfa.part2.Untyped.html#6427" class="Bound">ρ</a> <a id="6472" href="plfa.part2.Untyped.html#6434" class="Bound">M</a><a id="6473" class="Symbol">)</a>
</pre><p>This is exactly as before, save that there are fewer term forms.</p><h2 id="simultaneous-substitution">Simultaneous substitution</h2><p>Our definition of substitution is also exactly as before. First we need an extension lemma:</p><pre class="Agda"><a id="exts"></a><a id="6671" href="/19.08/Untyped/#6671" class="Function">exts</a> <a id="6676" class="Symbol">:</a> <a id="6678" class="Symbol">∀</a> <a id="6680" class="Symbol">{</a><a id="6681" href="plfa.part2.Untyped.html#6681" class="Bound">Γ</a> <a id="6683" href="plfa.part2.Untyped.html#6683" class="Bound">Δ</a><a id="6684" class="Symbol">}</a> <a id="6686" class="Symbol">→</a> <a id="6688" class="Symbol">(∀</a> <a id="6691" class="Symbol">{</a><a id="6692" href="plfa.part2.Untyped.html#6692" class="Bound">A</a><a id="6693" class="Symbol">}</a> <a id="6695" class="Symbol">→</a> <a id="6697" href="plfa.part2.Untyped.html#6681" class="Bound">Γ</a> <a id="6699" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6701" href="plfa.part2.Untyped.html#6692" class="Bound">A</a> <a id="6703" class="Symbol">→</a> <a id="6705" href="plfa.part2.Untyped.html#6683" class="Bound">Δ</a> <a id="6707" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="6709" href="plfa.part2.Untyped.html#6692" class="Bound">A</a><a id="6710" class="Symbol">)</a>
    <a id="6716" class="Comment">----------------------------------</a>
  <a id="6753" class="Symbol">→</a> <a id="6755" class="Symbol">(∀</a> <a id="6758" class="Symbol">{</a><a id="6759" href="/19.08/Untyped/#6759" class="Bound">A</a> <a id="6761" href="plfa.part2.Untyped.html#6761" class="Bound">B</a><a id="6762" class="Symbol">}</a> <a id="6764" class="Symbol">→</a> <a id="6766" href="plfa.part2.Untyped.html#6681" class="Bound">Γ</a> <a id="6768" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="6770" href="plfa.part2.Untyped.html#6761" class="Bound">B</a> <a id="6772" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6774" href="plfa.part2.Untyped.html#6759" class="Bound">A</a> <a id="6776" class="Symbol">→</a> <a id="6778" href="plfa.part2.Untyped.html#6683" class="Bound">Δ</a> <a id="6780" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="6782" href="plfa.part2.Untyped.html#6761" class="Bound">B</a> <a id="6784" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="6786" href="plfa.part2.Untyped.html#6759" class="Bound">A</a><a id="6787" class="Symbol">)</a>
<a id="6789" href="/19.08/Untyped/#6671" class="Function">exts</a> <a id="6794" href="plfa.part2.Untyped.html#6794" class="Bound">σ</a> <a id="6796" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a>      <a id="6803" class="Symbol">=</a>  <a id="6806" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="6808" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a>
<a id="6810" href="/19.08/Untyped/#6671" class="Function">exts</a> <a id="6815" href="plfa.part2.Untyped.html#6815" class="Bound">σ</a> <a id="6817" class="Symbol">(</a><a id="6818" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="6820" href="plfa.part2.Untyped.html#6820" class="Bound">x</a><a id="6821" class="Symbol">)</a>  <a id="6824" class="Symbol">=</a>  <a id="6827" href="plfa.part2.Untyped.html#6235" class="Function">rename</a> <a id="6834" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S_</a> <a id="6837" class="Symbol">(</a><a id="6838" href="plfa.part2.Untyped.html#6815" class="Bound">σ</a> <a id="6840" href="plfa.part2.Untyped.html#6820" class="Bound">x</a><a id="6841" class="Symbol">)</a>
</pre><p>Again, we could replace all instances of <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> by <code class="language-plaintext highlighter-rouge">★</code>.</p><p>Now it is straightforward to define substitution:</p><pre class="Agda"><a id="subst"></a><a id="6963" href="/19.08/Untyped/#6963" class="Function">subst</a> <a id="6969" class="Symbol">:</a> <a id="6971" class="Symbol">∀</a> <a id="6973" class="Symbol">{</a><a id="6974" href="plfa.part2.Untyped.html#6974" class="Bound">Γ</a> <a id="6976" href="plfa.part2.Untyped.html#6976" class="Bound">Δ</a><a id="6977" class="Symbol">}</a>
  <a id="6981" class="Symbol">→</a> <a id="6983" class="Symbol">(∀</a> <a id="6986" class="Symbol">{</a><a id="6987" href="/19.08/Untyped/#6987" class="Bound">A</a><a id="6988" class="Symbol">}</a> <a id="6990" class="Symbol">→</a> <a id="6992" href="plfa.part2.Untyped.html#6974" class="Bound">Γ</a> <a id="6994" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="6996" href="plfa.part2.Untyped.html#6987" class="Bound">A</a> <a id="6998" class="Symbol">→</a> <a id="7000" href="plfa.part2.Untyped.html#6976" class="Bound">Δ</a> <a id="7002" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7004" href="plfa.part2.Untyped.html#6987" class="Bound">A</a><a id="7005" class="Symbol">)</a>
    <a id="7011" class="Comment">------------------------</a>
  <a id="7038" class="Symbol">→</a> <a id="7040" class="Symbol">(∀</a> <a id="7043" class="Symbol">{</a><a id="7044" href="/19.08/Untyped/#7044" class="Bound">A</a><a id="7045" class="Symbol">}</a> <a id="7047" class="Symbol">→</a> <a id="7049" href="plfa.part2.Untyped.html#6974" class="Bound">Γ</a> <a id="7051" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7053" href="plfa.part2.Untyped.html#7044" class="Bound">A</a> <a id="7055" class="Symbol">→</a> <a id="7057" href="plfa.part2.Untyped.html#6976" class="Bound">Δ</a> <a id="7059" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7061" href="plfa.part2.Untyped.html#7044" class="Bound">A</a><a id="7062" class="Symbol">)</a>
<a id="7064" href="/19.08/Untyped/#6963" class="Function">subst</a> <a id="7070" href="plfa.part2.Untyped.html#7070" class="Bound">σ</a> <a id="7072" class="Symbol">(</a><a id="7073" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="7075" href="plfa.part2.Untyped.html#7075" class="Bound">k</a><a id="7076" class="Symbol">)</a>          <a id="7087" class="Symbol">=</a>  <a id="7090" href="plfa.part2.Untyped.html#7070" class="Bound">σ</a> <a id="7092" href="plfa.part2.Untyped.html#7075" class="Bound">k</a>
<a id="7094" href="/19.08/Untyped/#6963" class="Function">subst</a> <a id="7100" href="plfa.part2.Untyped.html#7100" class="Bound">σ</a> <a id="7102" class="Symbol">(</a><a id="7103" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="7105" href="plfa.part2.Untyped.html#7105" class="Bound">N</a><a id="7106" class="Symbol">)</a>          <a id="7117" class="Symbol">=</a>  <a id="7120" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="7122" class="Symbol">(</a><a id="7123" href="plfa.part2.Untyped.html#6963" class="Function">subst</a> <a id="7129" class="Symbol">(</a><a id="7130" href="plfa.part2.Untyped.html#6671" class="Function">exts</a> <a id="7135" href="plfa.part2.Untyped.html#7100" class="Bound">σ</a><a id="7136" class="Symbol">)</a> <a id="7138" href="plfa.part2.Untyped.html#7105" class="Bound">N</a><a id="7139" class="Symbol">)</a>
<a id="7141" href="/19.08/Untyped/#6963" class="Function">subst</a> <a id="7147" href="plfa.part2.Untyped.html#7147" class="Bound">σ</a> <a id="7149" class="Symbol">(</a><a id="7150" href="plfa.part2.Untyped.html#7150" class="Bound">L</a> <a id="7152" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="7154" href="plfa.part2.Untyped.html#7154" class="Bound">M</a><a id="7155" class="Symbol">)</a>        <a id="7164" class="Symbol">=</a>  <a id="7167" class="Symbol">(</a><a id="7168" href="plfa.part2.Untyped.html#6963" class="Function">subst</a> <a id="7174" href="plfa.part2.Untyped.html#7147" class="Bound">σ</a> <a id="7176" href="plfa.part2.Untyped.html#7150" class="Bound">L</a><a id="7177" class="Symbol">)</a> <a id="7179" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="7181" class="Symbol">(</a><a id="7182" href="plfa.part2.Untyped.html#6963" class="Function">subst</a> <a id="7188" href="plfa.part2.Untyped.html#7147" class="Bound">σ</a> <a id="7190" href="plfa.part2.Untyped.html#7154" class="Bound">M</a><a id="7191" class="Symbol">)</a>
</pre><p>Again, this is exactly as before, save that there are fewer term forms.</p><h2 id="single-substitution">Single substitution</h2><p>It is easy to define the special case of substitution for one free variable:</p><pre class="Agda"><a id="subst-zero"></a><a id="7375" href="/19.08/Untyped/#7375" class="Function">subst-zero</a> <a id="7386" class="Symbol">:</a> <a id="7388" class="Symbol">∀</a> <a id="7390" class="Symbol">{</a><a id="7391" href="plfa.part2.Untyped.html#7391" class="Bound">Γ</a> <a id="7393" href="plfa.part2.Untyped.html#7393" class="Bound">B</a><a id="7394" class="Symbol">}</a> <a id="7396" class="Symbol">→</a> <a id="7398" class="Symbol">(</a><a id="7399" href="plfa.part2.Untyped.html#7391" class="Bound">Γ</a> <a id="7401" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7403" href="plfa.part2.Untyped.html#7393" class="Bound">B</a><a id="7404" class="Symbol">)</a> <a id="7406" class="Symbol">→</a> <a id="7408" class="Symbol">∀</a> <a id="7410" class="Symbol">{</a><a id="7411" href="plfa.part2.Untyped.html#7411" class="Bound">A</a><a id="7412" class="Symbol">}</a> <a id="7414" class="Symbol">→</a> <a id="7416" class="Symbol">(</a><a id="7417" href="plfa.part2.Untyped.html#7391" class="Bound">Γ</a> <a id="7419" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="7421" href="plfa.part2.Untyped.html#7393" class="Bound">B</a> <a id="7423" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="7425" href="plfa.part2.Untyped.html#7411" class="Bound">A</a><a id="7426" class="Symbol">)</a> <a id="7428" class="Symbol">→</a> <a id="7430" class="Symbol">(</a><a id="7431" href="plfa.part2.Untyped.html#7391" class="Bound">Γ</a> <a id="7433" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7435" href="plfa.part2.Untyped.html#7411" class="Bound">A</a><a id="7436" class="Symbol">)</a>
<a id="7438" href="/19.08/Untyped/#7375" class="Function">subst-zero</a> <a id="7449" href="plfa.part2.Untyped.html#7449" class="Bound">M</a> <a id="7451" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a>      <a id="7458" class="Symbol">=</a>  <a id="7461" href="plfa.part2.Untyped.html#7449" class="Bound">M</a>
<a id="7463" href="/19.08/Untyped/#7375" class="Function">subst-zero</a> <a id="7474" href="plfa.part2.Untyped.html#7474" class="Bound">M</a> <a id="7476" class="Symbol">(</a><a id="7477" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="7479" href="plfa.part2.Untyped.html#7479" class="Bound">x</a><a id="7480" class="Symbol">)</a>  <a id="7483" class="Symbol">=</a>  <a id="7486" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="7488" href="plfa.part2.Untyped.html#7479" class="Bound">x</a>

<a id="_[_]"></a><a id="7491" href="/19.08/Untyped/#7491" class="Function Operator">_[_]</a> <a id="7496" class="Symbol">:</a> <a id="7498" class="Symbol">∀</a> <a id="7500" class="Symbol">{</a><a id="7501" href="plfa.part2.Untyped.html#7501" class="Bound">Γ</a> <a id="7503" href="plfa.part2.Untyped.html#7503" class="Bound">A</a> <a id="7505" href="plfa.part2.Untyped.html#7505" class="Bound">B</a><a id="7506" class="Symbol">}</a>
        <a id="7516" class="Symbol">→</a> <a id="7518" href="/19.08/Untyped/#7501" class="Bound">Γ</a> <a id="7520" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="7522" href="plfa.part2.Untyped.html#7505" class="Bound">B</a> <a id="7524" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7526" href="plfa.part2.Untyped.html#7503" class="Bound">A</a>
        <a id="7536" class="Symbol">→</a> <a id="7538" href="/19.08/Untyped/#7501" class="Bound">Γ</a> <a id="7540" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7542" href="plfa.part2.Untyped.html#7505" class="Bound">B</a>
          <a id="7554" class="Comment">---------</a>
        <a id="7572" class="Symbol">→</a> <a id="7574" href="/19.08/Untyped/#7501" class="Bound">Γ</a> <a id="7576" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7578" href="plfa.part2.Untyped.html#7503" class="Bound">A</a>
<a id="7580" href="/19.08/Untyped/#7491" class="Function Operator">_[_]</a> <a id="7585" class="Symbol">{</a><a id="7586" href="plfa.part2.Untyped.html#7586" class="Bound">Γ</a><a id="7587" class="Symbol">}</a> <a id="7589" class="Symbol">{</a><a id="7590" href="plfa.part2.Untyped.html#7590" class="Bound">A</a><a id="7591" class="Symbol">}</a> <a id="7593" class="Symbol">{</a><a id="7594" href="plfa.part2.Untyped.html#7594" class="Bound">B</a><a id="7595" class="Symbol">}</a> <a id="7597" href="plfa.part2.Untyped.html#7597" class="Bound">N</a> <a id="7599" href="plfa.part2.Untyped.html#7599" class="Bound">M</a> <a id="7601" class="Symbol">=</a>  <a id="7604" href="plfa.part2.Untyped.html#6963" class="Function">subst</a> <a id="7610" class="Symbol">{</a><a id="7611" href="plfa.part2.Untyped.html#7586" class="Bound">Γ</a> <a id="7613" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="7615" href="plfa.part2.Untyped.html#7594" class="Bound">B</a><a id="7616" class="Symbol">}</a> <a id="7618" class="Symbol">{</a><a id="7619" href="plfa.part2.Untyped.html#7586" class="Bound">Γ</a><a id="7620" class="Symbol">}</a> <a id="7622" class="Symbol">(</a><a id="7623" href="plfa.part2.Untyped.html#7375" class="Function">subst-zero</a> <a id="7634" href="plfa.part2.Untyped.html#7599" class="Bound">M</a><a id="7635" class="Symbol">)</a> <a id="7637" class="Symbol">{</a><a id="7638" href="plfa.part2.Untyped.html#7590" class="Bound">A</a><a id="7639" class="Symbol">}</a> <a id="7641" href="plfa.part2.Untyped.html#7597" class="Bound">N</a>
</pre><h2 id="neutral-and-normal-terms">Neutral and normal terms</h2><p>Reduction continues until a term is fully normalised. Hence, instead of values, we are now interested in <em>normal forms</em>. Terms in normal form are defined by mutual recursion with <em>neutral</em> terms:</p><pre class="Agda"><a id="7879" class="Keyword">data</a> <a id="Neutral"></a><a id="7884" href="/19.08/Untyped/#7884" class="Datatype">Neutral</a> <a id="7892" class="Symbol">:</a> <a id="7894" class="Symbol">∀</a> <a id="7896" class="Symbol">{</a><a id="7897" href="plfa.part2.Untyped.html#7897" class="Bound">Γ</a> <a id="7899" href="plfa.part2.Untyped.html#7899" class="Bound">A</a><a id="7900" class="Symbol">}</a> <a id="7902" class="Symbol">→</a> <a id="7904" href="plfa.part2.Untyped.html#7897" class="Bound">Γ</a> <a id="7906" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7908" href="plfa.part2.Untyped.html#7899" class="Bound">A</a> <a id="7910" class="Symbol">→</a> <a id="7912" class="PrimitiveType">Set</a>
<a id="7916" class="Keyword">data</a> <a id="Normal"></a><a id="7921" href="/19.08/Untyped/#7921" class="Datatype">Normal</a>  <a id="7929" class="Symbol">:</a> <a id="7931" class="Symbol">∀</a> <a id="7933" class="Symbol">{</a><a id="7934" href="plfa.part2.Untyped.html#7934" class="Bound">Γ</a> <a id="7936" href="plfa.part2.Untyped.html#7936" class="Bound">A</a><a id="7937" class="Symbol">}</a> <a id="7939" class="Symbol">→</a> <a id="7941" href="plfa.part2.Untyped.html#7934" class="Bound">Γ</a> <a id="7943" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="7945" href="plfa.part2.Untyped.html#7936" class="Bound">A</a> <a id="7947" class="Symbol">→</a> <a id="7949" class="PrimitiveType">Set</a>
</pre><p>Neutral terms arise because we now consider reduction of open terms, which may contain free variables. A term is neutral if it is a variable or a neutral term applied to a normal term:</p><pre class="Agda"><a id="8147" class="Keyword">data</a> <a id="8152" href="/19.08/Untyped/#7884" class="Datatype">Neutral</a> <a id="8160" class="Keyword">where</a>

  <a id="Neutral.`_"></a><a id="8169" href="/19.08/Untyped/#8169" class="InductiveConstructor Operator">`_</a>  <a id="8173" class="Symbol">:</a> <a id="8175" class="Symbol">∀</a> <a id="8177" class="Symbol">{</a><a id="8178" href="plfa.part2.Untyped.html#8178" class="Bound">Γ</a> <a id="8180" href="plfa.part2.Untyped.html#8180" class="Bound">A</a><a id="8181" class="Symbol">}</a> <a id="8183" class="Symbol">(</a><a id="8184" href="plfa.part2.Untyped.html#8184" class="Bound">x</a> <a id="8186" class="Symbol">:</a> <a id="8188" href="plfa.part2.Untyped.html#8178" class="Bound">Γ</a> <a id="8190" href="plfa.part2.Untyped.html#3521" class="Datatype Operator">∋</a> <a id="8192" href="plfa.part2.Untyped.html#8180" class="Bound">A</a><a id="8193" class="Symbol">)</a>
      <a id="8201" class="Comment">-------------</a>
    <a id="8219" class="Symbol">→</a> <a id="8221" href="/19.08/Untyped/#7884" class="Datatype">Neutral</a> <a id="8229" class="Symbol">(</a><a id="8230" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="8232" href="plfa.part2.Untyped.html#8184" class="Bound">x</a><a id="8233" class="Symbol">)</a>

  <a id="Neutral._·_"></a><a id="8238" href="/19.08/Untyped/#8238" class="InductiveConstructor Operator">_·_</a>  <a id="8243" class="Symbol">:</a> <a id="8245" class="Symbol">∀</a> <a id="8247" class="Symbol">{</a><a id="8248" href="plfa.part2.Untyped.html#8248" class="Bound">Γ</a><a id="8249" class="Symbol">}</a> <a id="8251" class="Symbol">{</a><a id="8252" href="plfa.part2.Untyped.html#8252" class="Bound">L</a> <a id="8254" href="plfa.part2.Untyped.html#8254" class="Bound">M</a> <a id="8256" class="Symbol">:</a> <a id="8258" href="plfa.part2.Untyped.html#8248" class="Bound">Γ</a> <a id="8260" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="8262" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="8263" class="Symbol">}</a>
    <a id="8269" class="Symbol">→</a> <a id="8271" href="/19.08/Untyped/#7884" class="Datatype">Neutral</a> <a id="8279" href="plfa.part2.Untyped.html#8252" class="Bound">L</a>
    <a id="8285" class="Symbol">→</a> <a id="8287" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="8294" href="plfa.part2.Untyped.html#8254" class="Bound">M</a>
      <a id="8302" class="Comment">---------------</a>
    <a id="8322" class="Symbol">→</a> <a id="8324" href="/19.08/Untyped/#7884" class="Datatype">Neutral</a> <a id="8332" class="Symbol">(</a><a id="8333" href="plfa.part2.Untyped.html#8252" class="Bound">L</a> <a id="8335" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="8337" href="plfa.part2.Untyped.html#8254" class="Bound">M</a><a id="8338" class="Symbol">)</a>
</pre><p>A term is a normal form if it is neutral or an abstraction where the body is a normal form. We use <code class="language-plaintext highlighter-rouge">′_</code> to label neutral terms. Like <code class="language-plaintext highlighter-rouge">`_</code>, it is unobtrusive:</p><pre class="Agda"><a id="8510" class="Keyword">data</a> <a id="8515" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="8522" class="Keyword">where</a>

  <a id="Normal.′_"></a><a id="8531" href="/19.08/Untyped/#8531" class="InductiveConstructor Operator">′_</a> <a id="8534" class="Symbol">:</a> <a id="8536" class="Symbol">∀</a> <a id="8538" class="Symbol">{</a><a id="8539" href="plfa.part2.Untyped.html#8539" class="Bound">Γ</a> <a id="8541" href="plfa.part2.Untyped.html#8541" class="Bound">A</a><a id="8542" class="Symbol">}</a> <a id="8544" class="Symbol">{</a><a id="8545" href="plfa.part2.Untyped.html#8545" class="Bound">M</a> <a id="8547" class="Symbol">:</a> <a id="8549" href="plfa.part2.Untyped.html#8539" class="Bound">Γ</a> <a id="8551" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="8553" href="plfa.part2.Untyped.html#8541" class="Bound">A</a><a id="8554" class="Symbol">}</a>
    <a id="8560" class="Symbol">→</a> <a id="8562" href="/19.08/Untyped/#7884" class="Datatype">Neutral</a> <a id="8570" href="plfa.part2.Untyped.html#8545" class="Bound">M</a>
      <a id="8578" class="Comment">---------</a>
    <a id="8592" class="Symbol">→</a> <a id="8594" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="8601" href="plfa.part2.Untyped.html#8545" class="Bound">M</a>

  <a id="Normal.ƛ_"></a><a id="8606" href="/19.08/Untyped/#8606" class="InductiveConstructor Operator">ƛ_</a>  <a id="8610" class="Symbol">:</a> <a id="8612" class="Symbol">∀</a> <a id="8614" class="Symbol">{</a><a id="8615" href="plfa.part2.Untyped.html#8615" class="Bound">Γ</a><a id="8616" class="Symbol">}</a> <a id="8618" class="Symbol">{</a><a id="8619" href="plfa.part2.Untyped.html#8619" class="Bound">N</a> <a id="8621" class="Symbol">:</a> <a id="8623" href="plfa.part2.Untyped.html#8615" class="Bound">Γ</a> <a id="8625" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="8627" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="8629" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="8631" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="8632" class="Symbol">}</a>
    <a id="8638" class="Symbol">→</a> <a id="8640" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="8647" href="plfa.part2.Untyped.html#8619" class="Bound">N</a>
      <a id="8655" class="Comment">------------</a>
    <a id="8672" class="Symbol">→</a> <a id="8674" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="8681" class="Symbol">(</a><a id="8682" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="8684" href="plfa.part2.Untyped.html#8619" class="Bound">N</a><a id="8685" class="Symbol">)</a>
</pre><p>We introduce a convenient abbreviation for evidence that a variable is neutral:</p><pre class="Agda"><a id="#′_"></a><a id="8776" href="/19.08/Untyped/#8776" class="Function Operator">#′_</a> <a id="8780" class="Symbol">:</a> <a id="8782" class="Symbol">∀</a> <a id="8784" class="Symbol">{</a><a id="8785" href="plfa.part2.Untyped.html#8785" class="Bound">Γ</a><a id="8786" class="Symbol">}</a> <a id="8788" class="Symbol">(</a><a id="8789" href="plfa.part2.Untyped.html#8789" class="Bound">n</a> <a id="8791" class="Symbol">:</a> <a id="8793" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="8794" class="Symbol">)</a> <a id="8796" class="Symbol">→</a> <a id="8798" href="plfa.part2.Untyped.html#7884" class="Datatype">Neutral</a> <a id="8806" class="Symbol">{</a><a id="8807" href="plfa.part2.Untyped.html#8785" class="Bound">Γ</a><a id="8808" class="Symbol">}</a> <a id="8810" class="Symbol">(</a><a id="8811" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="8813" href="plfa.part2.Untyped.html#8789" class="Bound">n</a><a id="8814" class="Symbol">)</a>
<a id="8816" href="/19.08/Untyped/#8776" class="Function Operator">#′</a> <a id="8819" href="plfa.part2.Untyped.html#8819" class="Bound">n</a>  <a id="8822" class="Symbol">=</a>  <a id="8825" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="8827" href="plfa.part2.Untyped.html#4870" class="Function">count</a> <a id="8833" href="plfa.part2.Untyped.html#8819" class="Bound">n</a>
</pre><p>For example, here is the evidence that the Church numeral two is in normal form:</p><pre class="Agda"><a id="8925" href="/19.08/Untyped/#8925" class="Function">_</a> <a id="8927" class="Symbol">:</a> <a id="8929" href="plfa.part2.Untyped.html#7921" class="Datatype">Normal</a> <a id="8936" class="Symbol">(</a><a id="8937" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="8942" class="Symbol">{</a><a id="8943" href="plfa.part2.Untyped.html#3175" class="InductiveConstructor">∅</a><a id="8944" class="Symbol">})</a>
<a id="8947" class="Symbol">_</a> <a id="8949" class="Symbol">=</a> <a id="8951" href="/19.08/Untyped/#8606" class="InductiveConstructor Operator">ƛ</a> <a id="8953" href="plfa.part2.Untyped.html#8606" class="InductiveConstructor Operator">ƛ</a> <a id="8955" class="Symbol">(</a><a id="8956" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="8958" href="plfa.part2.Untyped.html#8776" class="Function Operator">#′</a> <a id="8961" class="Number">1</a> <a id="8963" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="8965" class="Symbol">(</a><a id="8966" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="8968" href="plfa.part2.Untyped.html#8776" class="Function Operator">#′</a> <a id="8971" class="Number">1</a> <a id="8973" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="8975" class="Symbol">(</a><a id="8976" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="8978" href="plfa.part2.Untyped.html#8776" class="Function Operator">#′</a> <a id="8981" class="Number">0</a><a id="8982" class="Symbol">)))</a>
</pre><p>The evidence that a term is in normal form is almost identical to the term itself, decorated with some additional primes to indicate neutral terms, and using <code class="language-plaintext highlighter-rouge">#′</code> in place of <code class="language-plaintext highlighter-rouge">#</code></p><p>We will also need to characterise terms that are applications:</p><pre class="Agda"><a id="9237" class="Keyword">data</a> <a id="Application"></a><a id="9242" href="/19.08/Untyped/#9242" class="Datatype">Application</a> <a id="9254" class="Symbol">:</a> <a id="9256" class="Symbol">∀</a> <a id="9258" class="Symbol">{</a><a id="9259" href="plfa.part2.Untyped.html#9259" class="Bound">Γ</a> <a id="9261" href="plfa.part2.Untyped.html#9261" class="Bound">A</a><a id="9262" class="Symbol">}</a> <a id="9264" class="Symbol">→</a> <a id="9266" href="plfa.part2.Untyped.html#9259" class="Bound">Γ</a> <a id="9268" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="9270" href="plfa.part2.Untyped.html#9261" class="Bound">A</a> <a id="9272" class="Symbol">→</a> <a id="9274" class="PrimitiveType">Set</a> <a id="9278" class="Keyword">where</a>

  <a id="Application.ap"></a><a id="9287" href="/19.08/Untyped/#9287" class="InductiveConstructor">ap</a> <a id="9290" class="Symbol">:</a> <a id="9292" class="Symbol">∀</a> <a id="9294" class="Symbol">{</a><a id="9295" href="plfa.part2.Untyped.html#9295" class="Bound">Γ</a><a id="9296" class="Symbol">}</a> <a id="9298" class="Symbol">{</a><a id="9299" href="plfa.part2.Untyped.html#9299" class="Bound">L</a> <a id="9301" href="plfa.part2.Untyped.html#9301" class="Bound">M</a> <a id="9303" class="Symbol">:</a> <a id="9305" href="plfa.part2.Untyped.html#9295" class="Bound">Γ</a> <a id="9307" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="9309" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="9310" class="Symbol">}</a>
      <a id="9318" class="Comment">-------------------</a>
    <a id="9342" class="Symbol">→</a> <a id="9344" href="/19.08/Untyped/#9242" class="Datatype">Application</a> <a id="9356" class="Symbol">(</a><a id="9357" href="plfa.part2.Untyped.html#9299" class="Bound">L</a> <a id="9359" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="9361" href="plfa.part2.Untyped.html#9301" class="Bound">M</a><a id="9362" class="Symbol">)</a>
</pre><h2 id="reduction-step">Reduction step</h2><p>The reduction rules are altered to switch from call-by-value to call-by-name and to enable full normalisation:</p><ul><li><p>The rule <code class="language-plaintext highlighter-rouge">ξ₁</code> remains the same as it was for the simply-typed lambda calculus.</p></li><li><p>In rule <code class="language-plaintext highlighter-rouge">ξ₂</code>, the requirement that the term <code class="language-plaintext highlighter-rouge">L</code> is a value is dropped. So this rule can overlap with <code class="language-plaintext highlighter-rouge">ξ₁</code> and reduction is <em>non-deterministic</em>. One can choose to reduce a term inside either <code class="language-plaintext highlighter-rouge">L</code> or <code class="language-plaintext highlighter-rouge">M</code>.</p></li><li><p>In rule <code class="language-plaintext highlighter-rouge">β</code>, the requirement that the argument is a value is dropped, corresponding to call-by-name evaluation. This introduces further non-determinism, as <code class="language-plaintext highlighter-rouge">β</code> overlaps with <code class="language-plaintext highlighter-rouge">ξ₂</code> when there are redexes in the argument.</p></li><li><p>A new rule <code class="language-plaintext highlighter-rouge">ζ</code> is added, to enable reduction underneath a lambda.</p></li></ul><p>Here are the formalised rules:</p><pre class="Agda"><a id="10128" class="Keyword">infix</a> <a id="10134" class="Number">2</a> <a id="10136" href="/19.08/Untyped/#10147" class="Datatype Operator">_—→_</a>

<a id="10142" class="Keyword">data</a> <a id="_—→_"></a><a id="10147" href="/19.08/Untyped/#10147" class="Datatype Operator">_—→_</a> <a id="10152" class="Symbol">:</a> <a id="10154" class="Symbol">∀</a> <a id="10156" class="Symbol">{</a><a id="10157" href="plfa.part2.Untyped.html#10157" class="Bound">Γ</a> <a id="10159" href="plfa.part2.Untyped.html#10159" class="Bound">A</a><a id="10160" class="Symbol">}</a> <a id="10162" class="Symbol">→</a> <a id="10164" class="Symbol">(</a><a id="10165" href="plfa.part2.Untyped.html#10157" class="Bound">Γ</a> <a id="10167" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10169" href="plfa.part2.Untyped.html#10159" class="Bound">A</a><a id="10170" class="Symbol">)</a> <a id="10172" class="Symbol">→</a> <a id="10174" class="Symbol">(</a><a id="10175" href="plfa.part2.Untyped.html#10157" class="Bound">Γ</a> <a id="10177" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10179" href="plfa.part2.Untyped.html#10159" class="Bound">A</a><a id="10180" class="Symbol">)</a> <a id="10182" class="Symbol">→</a> <a id="10184" class="PrimitiveType">Set</a> <a id="10188" class="Keyword">where</a>

  <a id="_—→_.ξ₁"></a><a id="10197" href="/19.08/Untyped/#10197" class="InductiveConstructor">ξ₁</a> <a id="10200" class="Symbol">:</a> <a id="10202" class="Symbol">∀</a> <a id="10204" class="Symbol">{</a><a id="10205" href="plfa.part2.Untyped.html#10205" class="Bound">Γ</a><a id="10206" class="Symbol">}</a> <a id="10208" class="Symbol">{</a><a id="10209" href="plfa.part2.Untyped.html#10209" class="Bound">L</a> <a id="10211" href="plfa.part2.Untyped.html#10211" class="Bound">L′</a> <a id="10214" href="plfa.part2.Untyped.html#10214" class="Bound">M</a> <a id="10216" class="Symbol">:</a> <a id="10218" href="plfa.part2.Untyped.html#10205" class="Bound">Γ</a> <a id="10220" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10222" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="10223" class="Symbol">}</a>
    <a id="10229" class="Symbol">→</a> <a id="10231" href="/19.08/Untyped/#10209" class="Bound">L</a> <a id="10233" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10236" href="plfa.part2.Untyped.html#10211" class="Bound">L′</a>
      <a id="10245" class="Comment">----------------</a>
    <a id="10266" class="Symbol">→</a> <a id="10268" href="/19.08/Untyped/#10209" class="Bound">L</a> <a id="10270" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="10272" href="plfa.part2.Untyped.html#10214" class="Bound">M</a> <a id="10274" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10277" href="plfa.part2.Untyped.html#10211" class="Bound">L′</a> <a id="10280" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="10282" href="plfa.part2.Untyped.html#10214" class="Bound">M</a>

  <a id="_—→_.ξ₂"></a><a id="10287" href="/19.08/Untyped/#10287" class="InductiveConstructor">ξ₂</a> <a id="10290" class="Symbol">:</a> <a id="10292" class="Symbol">∀</a> <a id="10294" class="Symbol">{</a><a id="10295" href="plfa.part2.Untyped.html#10295" class="Bound">Γ</a><a id="10296" class="Symbol">}</a> <a id="10298" class="Symbol">{</a><a id="10299" href="plfa.part2.Untyped.html#10299" class="Bound">L</a> <a id="10301" href="plfa.part2.Untyped.html#10301" class="Bound">M</a> <a id="10303" href="plfa.part2.Untyped.html#10303" class="Bound">M′</a> <a id="10306" class="Symbol">:</a> <a id="10308" href="plfa.part2.Untyped.html#10295" class="Bound">Γ</a> <a id="10310" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10312" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="10313" class="Symbol">}</a>
    <a id="10319" class="Symbol">→</a> <a id="10321" href="/19.08/Untyped/#10301" class="Bound">M</a> <a id="10323" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10326" href="plfa.part2.Untyped.html#10303" class="Bound">M′</a>
      <a id="10335" class="Comment">----------------</a>
    <a id="10356" class="Symbol">→</a> <a id="10358" href="/19.08/Untyped/#10299" class="Bound">L</a> <a id="10360" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="10362" href="plfa.part2.Untyped.html#10301" class="Bound">M</a> <a id="10364" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10367" href="plfa.part2.Untyped.html#10299" class="Bound">L</a> <a id="10369" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="10371" href="plfa.part2.Untyped.html#10303" class="Bound">M′</a>

  <a id="_—→_.β"></a><a id="10377" href="/19.08/Untyped/#10377" class="InductiveConstructor">β</a> <a id="10379" class="Symbol">:</a> <a id="10381" class="Symbol">∀</a> <a id="10383" class="Symbol">{</a><a id="10384" href="plfa.part2.Untyped.html#10384" class="Bound">Γ</a><a id="10385" class="Symbol">}</a> <a id="10387" class="Symbol">{</a><a id="10388" href="plfa.part2.Untyped.html#10388" class="Bound">N</a> <a id="10390" class="Symbol">:</a> <a id="10392" href="plfa.part2.Untyped.html#10384" class="Bound">Γ</a> <a id="10394" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="10396" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="10398" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10400" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="10401" class="Symbol">}</a> <a id="10403" class="Symbol">{</a><a id="10404" href="plfa.part2.Untyped.html#10404" class="Bound">M</a> <a id="10406" class="Symbol">:</a> <a id="10408" href="plfa.part2.Untyped.html#10384" class="Bound">Γ</a> <a id="10410" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10412" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="10413" class="Symbol">}</a>
      <a id="10421" class="Comment">---------------------------------</a>
    <a id="10459" class="Symbol">→</a> <a id="10461" class="Symbol">(</a><a id="10462" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="10464" href="plfa.part2.Untyped.html#10388" class="Bound">N</a><a id="10465" class="Symbol">)</a> <a id="10467" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="10469" href="plfa.part2.Untyped.html#10404" class="Bound">M</a> <a id="10471" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10474" href="plfa.part2.Untyped.html#10388" class="Bound">N</a> <a id="10476" href="plfa.part2.Untyped.html#7491" class="Function Operator">[</a> <a id="10478" href="plfa.part2.Untyped.html#10404" class="Bound">M</a> <a id="10480" href="plfa.part2.Untyped.html#7491" class="Function Operator">]</a>

  <a id="_—→_.ζ"></a><a id="10485" href="/19.08/Untyped/#10485" class="InductiveConstructor">ζ</a> <a id="10487" class="Symbol">:</a> <a id="10489" class="Symbol">∀</a> <a id="10491" class="Symbol">{</a><a id="10492" href="plfa.part2.Untyped.html#10492" class="Bound">Γ</a><a id="10493" class="Symbol">}</a> <a id="10495" class="Symbol">{</a><a id="10496" href="plfa.part2.Untyped.html#10496" class="Bound">N</a> <a id="10498" href="plfa.part2.Untyped.html#10498" class="Bound">N′</a> <a id="10501" class="Symbol">:</a> <a id="10503" href="plfa.part2.Untyped.html#10492" class="Bound">Γ</a> <a id="10505" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="10507" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="10509" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="10511" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="10512" class="Symbol">}</a>
    <a id="10518" class="Symbol">→</a> <a id="10520" href="/19.08/Untyped/#10496" class="Bound">N</a> <a id="10522" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10525" href="plfa.part2.Untyped.html#10498" class="Bound">N′</a>
      <a id="10534" class="Comment">-----------</a>
    <a id="10550" class="Symbol">→</a> <a id="10552" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="10554" href="plfa.part2.Untyped.html#10496" class="Bound">N</a> <a id="10556" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="10559" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="10561" href="plfa.part2.Untyped.html#10498" class="Bound">N′</a>
</pre><h4 id="exercise-variant-1-practice">Exercise (<code class="language-plaintext highlighter-rouge">variant-1</code>) (practice)</h4><p>How would the rules change if we want call-by-value where terms normalise completely? Assume that <code class="language-plaintext highlighter-rouge">β</code> should not permit reduction unless both terms are in normal form.</p><pre class="Agda"><a id="10783" class="Comment">-- Your code goes here</a>
</pre><h4 id="exercise-variant-2-practice">Exercise (<code class="language-plaintext highlighter-rouge">variant-2</code>) (practice)</h4><p>How would the rules change if we want call-by-value where terms do not reduce underneath lambda? Assume that <code class="language-plaintext highlighter-rouge">β</code> permits reduction when both terms are values (that is, lambda abstractions). What would <code class="language-plaintext highlighter-rouge">2+2ᶜ</code> reduce to in this case?</p><pre class="Agda"><a id="11090" class="Comment">-- Your code goes here</a>
</pre><h2 id="reflexive-and-transitive-closure">Reflexive and transitive closure</h2><p>We cut-and-paste the previous definition:</p><pre class="Agda"><a id="11202" class="Keyword">infix</a>  <a id="11209" class="Number">2</a> <a id="11211" href="/19.08/Untyped/#11267" class="Datatype Operator">_—↠_</a>
<a id="11216" class="Keyword">infix</a>  <a id="11223" class="Number">1</a> <a id="11225" href="/19.08/Untyped/#11473" class="Function Operator">begin_</a>
<a id="11232" class="Keyword">infixr</a> <a id="11239" class="Number">2</a> <a id="11241" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">_—→⟨_⟩_</a>
<a id="11249" class="Keyword">infix</a>  <a id="11256" class="Number">3</a> <a id="11258" href="/19.08/Untyped/#11317" class="InductiveConstructor Operator">_∎</a>

<a id="11262" class="Keyword">data</a> <a id="_—↠_"></a><a id="11267" href="/19.08/Untyped/#11267" class="Datatype Operator">_—↠_</a> <a id="11272" class="Symbol">:</a> <a id="11274" class="Symbol">∀</a> <a id="11276" class="Symbol">{</a><a id="11277" href="plfa.part2.Untyped.html#11277" class="Bound">Γ</a> <a id="11279" href="plfa.part2.Untyped.html#11279" class="Bound">A</a><a id="11280" class="Symbol">}</a> <a id="11282" class="Symbol">→</a> <a id="11284" class="Symbol">(</a><a id="11285" href="plfa.part2.Untyped.html#11277" class="Bound">Γ</a> <a id="11287" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="11289" href="plfa.part2.Untyped.html#11279" class="Bound">A</a><a id="11290" class="Symbol">)</a> <a id="11292" class="Symbol">→</a> <a id="11294" class="Symbol">(</a><a id="11295" href="plfa.part2.Untyped.html#11277" class="Bound">Γ</a> <a id="11297" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="11299" href="plfa.part2.Untyped.html#11279" class="Bound">A</a><a id="11300" class="Symbol">)</a> <a id="11302" class="Symbol">→</a> <a id="11304" class="PrimitiveType">Set</a> <a id="11308" class="Keyword">where</a>

  <a id="_—↠_._∎"></a><a id="11317" href="/19.08/Untyped/#11317" class="InductiveConstructor Operator">_∎</a> <a id="11320" class="Symbol">:</a> <a id="11322" class="Symbol">∀</a> <a id="11324" class="Symbol">{</a><a id="11325" href="plfa.part2.Untyped.html#11325" class="Bound">Γ</a> <a id="11327" href="plfa.part2.Untyped.html#11327" class="Bound">A</a><a id="11328" class="Symbol">}</a> <a id="11330" class="Symbol">(</a><a id="11331" href="plfa.part2.Untyped.html#11331" class="Bound">M</a> <a id="11333" class="Symbol">:</a> <a id="11335" href="plfa.part2.Untyped.html#11325" class="Bound">Γ</a> <a id="11337" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="11339" href="plfa.part2.Untyped.html#11327" class="Bound">A</a><a id="11340" class="Symbol">)</a>
      <a id="11348" class="Comment">--------</a>
    <a id="11361" class="Symbol">→</a> <a id="11363" href="/19.08/Untyped/#11331" class="Bound">M</a> <a id="11365" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="11368" href="plfa.part2.Untyped.html#11331" class="Bound">M</a>

  <a id="_—↠_._—→⟨_⟩_"></a><a id="11373" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">_—→⟨_⟩_</a> <a id="11381" class="Symbol">:</a> <a id="11383" class="Symbol">∀</a> <a id="11385" class="Symbol">{</a><a id="11386" href="plfa.part2.Untyped.html#11386" class="Bound">Γ</a> <a id="11388" href="plfa.part2.Untyped.html#11388" class="Bound">A</a><a id="11389" class="Symbol">}</a> <a id="11391" class="Symbol">(</a><a id="11392" href="plfa.part2.Untyped.html#11392" class="Bound">L</a> <a id="11394" class="Symbol">:</a> <a id="11396" href="plfa.part2.Untyped.html#11386" class="Bound">Γ</a> <a id="11398" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="11400" href="plfa.part2.Untyped.html#11388" class="Bound">A</a><a id="11401" class="Symbol">)</a> <a id="11403" class="Symbol">{</a><a id="11404" href="plfa.part2.Untyped.html#11404" class="Bound">M</a> <a id="11406" href="plfa.part2.Untyped.html#11406" class="Bound">N</a> <a id="11408" class="Symbol">:</a> <a id="11410" href="plfa.part2.Untyped.html#11386" class="Bound">Γ</a> <a id="11412" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="11414" href="plfa.part2.Untyped.html#11388" class="Bound">A</a><a id="11415" class="Symbol">}</a>
    <a id="11421" class="Symbol">→</a> <a id="11423" href="/19.08/Untyped/#11392" class="Bound">L</a> <a id="11425" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="11428" href="plfa.part2.Untyped.html#11404" class="Bound">M</a>
    <a id="11434" class="Symbol">→</a> <a id="11436" href="/19.08/Untyped/#11404" class="Bound">M</a> <a id="11438" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="11441" href="plfa.part2.Untyped.html#11406" class="Bound">N</a>
      <a id="11449" class="Comment">---------</a>
    <a id="11463" class="Symbol">→</a> <a id="11465" href="/19.08/Untyped/#11392" class="Bound">L</a> <a id="11467" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="11470" href="plfa.part2.Untyped.html#11406" class="Bound">N</a>

<a id="begin_"></a><a id="11473" href="/19.08/Untyped/#11473" class="Function Operator">begin_</a> <a id="11480" class="Symbol">:</a> <a id="11482" class="Symbol">∀</a> <a id="11484" class="Symbol">{</a><a id="11485" href="plfa.part2.Untyped.html#11485" class="Bound">Γ</a><a id="11486" class="Symbol">}</a> <a id="11488" class="Symbol">{</a><a id="11489" href="plfa.part2.Untyped.html#11489" class="Bound">A</a><a id="11490" class="Symbol">}</a> <a id="11492" class="Symbol">{</a><a id="11493" href="plfa.part2.Untyped.html#11493" class="Bound">M</a> <a id="11495" href="plfa.part2.Untyped.html#11495" class="Bound">N</a> <a id="11497" class="Symbol">:</a> <a id="11499" href="plfa.part2.Untyped.html#11485" class="Bound">Γ</a> <a id="11501" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="11503" href="plfa.part2.Untyped.html#11489" class="Bound">A</a><a id="11504" class="Symbol">}</a>
  <a id="11508" class="Symbol">→</a> <a id="11510" href="/19.08/Untyped/#11493" class="Bound">M</a> <a id="11512" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="11515" href="plfa.part2.Untyped.html#11495" class="Bound">N</a>
    <a id="11521" class="Comment">------</a>
  <a id="11530" class="Symbol">→</a> <a id="11532" href="/19.08/Untyped/#11493" class="Bound">M</a> <a id="11534" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="11537" href="plfa.part2.Untyped.html#11495" class="Bound">N</a>
<a id="11539" href="/19.08/Untyped/#11473" class="Function Operator">begin</a> <a id="11545" href="plfa.part2.Untyped.html#11545" class="Bound">M—↠N</a> <a id="11550" class="Symbol">=</a> <a id="11552" href="plfa.part2.Untyped.html#11545" class="Bound">M—↠N</a>
</pre><h2 id="example-reduction-sequence">Example reduction sequence</h2><p>Here is the demonstration that two plus two is four:</p><pre class="Agda"><a id="11651" href="/19.08/Untyped/#11651" class="Function">_</a> <a id="11653" class="Symbol">:</a> <a id="11655" href="plfa.part2.Untyped.html#5437" class="Function">2+2ᶜ</a> <a id="11660" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="11663" href="plfa.part2.Untyped.html#5295" class="Function">fourᶜ</a>
<a id="11669" class="Symbol">_</a> <a id="11671" class="Symbol">=</a>
  <a id="11675" href="/19.08/Untyped/#11473" class="Function Operator">begin</a>
    <a id="11685" href="/19.08/Untyped/#5366" class="Function">plusᶜ</a> <a id="11691" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11693" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="11698" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11700" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a>
  <a id="11707" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="11711" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="11714" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a> <a id="11716" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="11722" class="Symbol">(</a><a id="11723" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11725" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11727" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11729" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="11734" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11736" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11738" class="Number">1</a> <a id="11740" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11742" class="Symbol">(</a><a id="11743" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11745" class="Number">2</a> <a id="11747" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11749" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11751" class="Number">1</a> <a id="11753" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11755" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11757" class="Number">0</a><a id="11758" class="Symbol">))</a> <a id="11761" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11763" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a>
  <a id="11770" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="11774" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a> <a id="11776" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="11782" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11784" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11786" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="11791" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11793" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11795" class="Number">1</a> <a id="11797" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11799" class="Symbol">(</a><a id="11800" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="11805" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11807" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11809" class="Number">1</a> <a id="11811" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11813" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11815" class="Number">0</a><a id="11816" class="Symbol">)</a>
  <a id="11820" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="11824" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="11826" class="Symbol">(</a><a id="11827" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="11829" class="Symbol">(</a><a id="11830" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="11833" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="11834" class="Symbol">))</a> <a id="11837" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="11843" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11845" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11847" class="Symbol">((</a><a id="11849" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11851" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11853" class="Number">2</a> <a id="11855" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11857" class="Symbol">(</a><a id="11858" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11860" class="Number">2</a> <a id="11862" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11864" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11866" class="Number">0</a><a id="11867" class="Symbol">))</a> <a id="11870" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11872" class="Symbol">(</a><a id="11873" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="11878" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11880" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11882" class="Number">1</a> <a id="11884" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11886" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11888" class="Number">0</a><a id="11889" class="Symbol">))</a>
  <a id="11894" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="11898" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="11900" class="Symbol">(</a><a id="11901" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="11903" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="11904" class="Symbol">)</a> <a id="11906" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="11912" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11914" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11916" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11918" class="Number">1</a> <a id="11920" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11922" class="Symbol">(</a><a id="11923" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11925" class="Number">1</a> <a id="11927" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11929" class="Symbol">(</a><a id="11930" href="plfa.part2.Untyped.html#5242" class="Function">twoᶜ</a> <a id="11935" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11937" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11939" class="Number">1</a> <a id="11941" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11943" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11945" class="Number">0</a><a id="11946" class="Symbol">))</a>
  <a id="11951" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="11955" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="11957" class="Symbol">(</a><a id="11958" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="11960" class="Symbol">(</a><a id="11961" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="11964" class="Symbol">(</a><a id="11965" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="11968" class="Symbol">(</a><a id="11969" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="11972" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="11973" class="Symbol">))))</a> <a id="11978" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="11984" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11986" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="11988" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11990" class="Number">1</a> <a id="11992" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="11994" class="Symbol">(</a><a id="11995" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="11997" class="Number">1</a> <a id="11999" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12001" class="Symbol">((</a><a id="12003" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="12005" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12007" class="Number">2</a> <a id="12009" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12011" class="Symbol">(</a><a id="12012" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12014" class="Number">2</a> <a id="12016" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12018" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12020" class="Number">0</a><a id="12021" class="Symbol">))</a> <a id="12024" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12026" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12028" class="Number">0</a><a id="12029" class="Symbol">))</a>
  <a id="12034" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="12038" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="12040" class="Symbol">(</a><a id="12041" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="12043" class="Symbol">(</a><a id="12044" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="12047" class="Symbol">(</a><a id="12048" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="12051" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="12052" class="Symbol">)))</a> <a id="12056" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
   <a id="12061" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="12063" class="Symbol">(</a><a id="12064" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="12066" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12068" class="Number">1</a> <a id="12070" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12072" class="Symbol">(</a><a id="12073" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12075" class="Number">1</a> <a id="12077" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12079" class="Symbol">(</a><a id="12080" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12082" class="Number">1</a> <a id="12084" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12086" class="Symbol">(</a><a id="12087" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12089" class="Number">1</a> <a id="12091" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="12093" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="12095" class="Number">0</a><a id="12096" class="Symbol">))))</a>
  <a id="12103" href="/19.08/Untyped/#11317" class="InductiveConstructor Operator">∎</a>
</pre><p>After just two steps the top-level term is an abstraction, and <code class="language-plaintext highlighter-rouge">ζ</code> rules drive the rest of the normalisation.</p><h2 id="progress">Progress</h2><p>Progress adapts. Instead of claiming that every term either is a value or takes a reduction step, we claim that every term is either in normal form or takes a reduction step.</p><p>Previously, progress only applied to closed, well-typed terms. We had to rule out terms where we apply something other than a function (such as <code class="language-plaintext highlighter-rouge">`zero</code>) or terms with a free variable. Now we can demonstrate it for open, well-scoped terms. The definition of normal form permits free variables, and we have no terms that are not functions.</p><p>A term makes progress if it can take a step or is in normal form:</p><pre class="Agda"><a id="12828" class="Keyword">data</a> <a id="Progress"></a><a id="12833" href="/19.08/Untyped/#12833" class="Datatype">Progress</a> <a id="12842" class="Symbol">{</a><a id="12843" href="plfa.part2.Untyped.html#12843" class="Bound">Γ</a> <a id="12845" href="plfa.part2.Untyped.html#12845" class="Bound">A</a><a id="12846" class="Symbol">}</a> <a id="12848" class="Symbol">(</a><a id="12849" href="plfa.part2.Untyped.html#12849" class="Bound">M</a> <a id="12851" class="Symbol">:</a> <a id="12853" href="plfa.part2.Untyped.html#12843" class="Bound">Γ</a> <a id="12855" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="12857" href="plfa.part2.Untyped.html#12845" class="Bound">A</a><a id="12858" class="Symbol">)</a> <a id="12860" class="Symbol">:</a> <a id="12862" class="PrimitiveType">Set</a> <a id="12866" class="Keyword">where</a>

  <a id="Progress.step"></a><a id="12875" href="/19.08/Untyped/#12875" class="InductiveConstructor">step</a> <a id="12880" class="Symbol">:</a> <a id="12882" class="Symbol">∀</a> <a id="12884" class="Symbol">{</a><a id="12885" href="plfa.part2.Untyped.html#12885" class="Bound">N</a> <a id="12887" class="Symbol">:</a> <a id="12889" href="plfa.part2.Untyped.html#12843" class="Bound">Γ</a> <a id="12891" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="12893" href="plfa.part2.Untyped.html#12845" class="Bound">A</a><a id="12894" class="Symbol">}</a>
    <a id="12900" class="Symbol">→</a> <a id="12902" href="/19.08/Untyped/#12849" class="Bound">M</a> <a id="12904" href="plfa.part2.Untyped.html#10147" class="Datatype Operator">—→</a> <a id="12907" href="plfa.part2.Untyped.html#12885" class="Bound">N</a>
      <a id="12915" class="Comment">----------</a>
    <a id="12930" class="Symbol">→</a> <a id="12932" href="/19.08/Untyped/#12833" class="Datatype">Progress</a> <a id="12941" href="plfa.part2.Untyped.html#12849" class="Bound">M</a>

  <a id="Progress.done"></a><a id="12946" href="/19.08/Untyped/#12946" class="InductiveConstructor">done</a> <a id="12951" class="Symbol">:</a>
      <a id="12959" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="12966" href="plfa.part2.Untyped.html#12849" class="Bound">M</a>
      <a id="12974" class="Comment">----------</a>
    <a id="12989" class="Symbol">→</a> <a id="12991" href="/19.08/Untyped/#12833" class="Datatype">Progress</a> <a id="13000" href="plfa.part2.Untyped.html#12849" class="Bound">M</a>
</pre><p>If a term is well scoped then it satisfies progress:</p><pre class="Agda"><a id="progress"></a><a id="13064" href="/19.08/Untyped/#13064" class="Function">progress</a> <a id="13073" class="Symbol">:</a> <a id="13075" class="Symbol">∀</a> <a id="13077" class="Symbol">{</a><a id="13078" href="plfa.part2.Untyped.html#13078" class="Bound">Γ</a> <a id="13080" href="plfa.part2.Untyped.html#13080" class="Bound">A</a><a id="13081" class="Symbol">}</a> <a id="13083" class="Symbol">→</a> <a id="13085" class="Symbol">(</a><a id="13086" href="plfa.part2.Untyped.html#13086" class="Bound">M</a> <a id="13088" class="Symbol">:</a> <a id="13090" href="plfa.part2.Untyped.html#13078" class="Bound">Γ</a> <a id="13092" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="13094" href="plfa.part2.Untyped.html#13080" class="Bound">A</a><a id="13095" class="Symbol">)</a> <a id="13097" class="Symbol">→</a> <a id="13099" href="plfa.part2.Untyped.html#12833" class="Datatype">Progress</a> <a id="13108" href="plfa.part2.Untyped.html#13086" class="Bound">M</a>
<a id="13110" href="/19.08/Untyped/#13064" class="Function">progress</a> <a id="13119" class="Symbol">(</a><a id="13120" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="13122" href="plfa.part2.Untyped.html#13122" class="Bound">x</a><a id="13123" class="Symbol">)</a>                                 <a id="13157" class="Symbol">=</a>  <a id="13160" href="plfa.part2.Untyped.html#12946" class="InductiveConstructor">done</a> <a id="13165" class="Symbol">(</a><a id="13166" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="13168" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="13170" href="plfa.part2.Untyped.html#13122" class="Bound">x</a><a id="13171" class="Symbol">)</a>
<a id="13173" href="/19.08/Untyped/#13064" class="Function">progress</a> <a id="13182" class="Symbol">(</a><a id="13183" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="13185" href="plfa.part2.Untyped.html#13185" class="Bound">N</a><a id="13186" class="Symbol">)</a>  <a id="13189" class="Keyword">with</a>  <a id="13195" href="plfa.part2.Untyped.html#13064" class="Function">progress</a> <a id="13204" href="plfa.part2.Untyped.html#13185" class="Bound">N</a>
<a id="13206" class="Symbol">...</a> <a id="13210" class="Symbol">|</a> <a id="13212" href="/19.08/Untyped/#12875" class="InductiveConstructor">step</a> <a id="13217" href="plfa.part2.Untyped.html#13217" class="Bound">N—→N′</a>                               <a id="13253" class="Symbol">=</a>  <a id="13256" href="plfa.part2.Untyped.html#12875" class="InductiveConstructor">step</a> <a id="13261" class="Symbol">(</a><a id="13262" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="13264" href="plfa.part2.Untyped.html#13217" class="Bound">N—→N′</a><a id="13269" class="Symbol">)</a>
<a id="13271" class="Symbol">...</a> <a id="13275" class="Symbol">|</a> <a id="13277" href="/19.08/Untyped/#12946" class="InductiveConstructor">done</a> <a id="13282" href="plfa.part2.Untyped.html#13282" class="Bound">NrmN</a>                                <a id="13318" class="Symbol">=</a>  <a id="13321" href="plfa.part2.Untyped.html#12946" class="InductiveConstructor">done</a> <a id="13326" class="Symbol">(</a><a id="13327" href="plfa.part2.Untyped.html#8606" class="InductiveConstructor Operator">ƛ</a> <a id="13329" href="plfa.part2.Untyped.html#13282" class="Bound">NrmN</a><a id="13333" class="Symbol">)</a>
<a id="13335" href="/19.08/Untyped/#13064" class="Function">progress</a> <a id="13344" class="Symbol">(</a><a id="13345" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="13347" href="plfa.part2.Untyped.html#13347" class="Bound">x</a> <a id="13349" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="13351" href="plfa.part2.Untyped.html#13351" class="Bound">M</a><a id="13352" class="Symbol">)</a> <a id="13354" class="Keyword">with</a> <a id="13359" href="plfa.part2.Untyped.html#13064" class="Function">progress</a> <a id="13368" href="plfa.part2.Untyped.html#13351" class="Bound">M</a>
<a id="13370" class="Symbol">...</a> <a id="13374" class="Symbol">|</a> <a id="13376" href="/19.08/Untyped/#12875" class="InductiveConstructor">step</a> <a id="13381" href="plfa.part2.Untyped.html#13381" class="Bound">M—→M′</a>                               <a id="13417" class="Symbol">=</a>  <a id="13420" href="plfa.part2.Untyped.html#12875" class="InductiveConstructor">step</a> <a id="13425" class="Symbol">(</a><a id="13426" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="13429" href="plfa.part2.Untyped.html#13381" class="Bound">M—→M′</a><a id="13434" class="Symbol">)</a>
<a id="13436" class="Symbol">...</a> <a id="13440" class="Symbol">|</a> <a id="13442" href="/19.08/Untyped/#12946" class="InductiveConstructor">done</a> <a id="13447" href="plfa.part2.Untyped.html#13447" class="Bound">NrmM</a>                                <a id="13483" class="Symbol">=</a>  <a id="13486" href="plfa.part2.Untyped.html#12946" class="InductiveConstructor">done</a> <a id="13491" class="Symbol">(</a><a id="13492" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="13494" class="Symbol">(</a><a id="13495" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="13497" class="Bound">x</a><a id="13498" class="Symbol">)</a> <a id="13500" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="13502" href="plfa.part2.Untyped.html#13447" class="Bound">NrmM</a><a id="13506" class="Symbol">)</a>
<a id="13508" href="/19.08/Untyped/#13064" class="Function">progress</a> <a id="13517" class="Symbol">((</a><a id="13519" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="13521" href="plfa.part2.Untyped.html#13521" class="Bound">N</a><a id="13522" class="Symbol">)</a> <a id="13524" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="13526" href="plfa.part2.Untyped.html#13526" class="Bound">M</a><a id="13527" class="Symbol">)</a>                           <a id="13555" class="Symbol">=</a>  <a id="13558" href="plfa.part2.Untyped.html#12875" class="InductiveConstructor">step</a> <a id="13563" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a>
<a id="13565" href="/19.08/Untyped/#13064" class="Function">progress</a> <a id="13574" class="Symbol">(</a><a id="13575" href="plfa.part2.Untyped.html#13575" class="Bound">L</a><a id="13576" class="Symbol">@(_</a> <a id="13580" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="13582" class="Symbol">_)</a> <a id="13585" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="13587" href="plfa.part2.Untyped.html#13587" class="Bound">M</a><a id="13588" class="Symbol">)</a> <a id="13590" class="Keyword">with</a> <a id="13595" href="plfa.part2.Untyped.html#13064" class="Function">progress</a> <a id="13604" href="plfa.part2.Untyped.html#13575" class="Bound">L</a>
<a id="13606" class="Symbol">...</a> <a id="13610" class="Symbol">|</a> <a id="13612" href="/19.08/Untyped/#12875" class="InductiveConstructor">step</a> <a id="13617" href="plfa.part2.Untyped.html#13617" class="Bound">L—→L′</a>                               <a id="13653" class="Symbol">=</a>  <a id="13656" href="plfa.part2.Untyped.html#12875" class="InductiveConstructor">step</a> <a id="13661" class="Symbol">(</a><a id="13662" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="13665" href="plfa.part2.Untyped.html#13617" class="Bound">L—→L′</a><a id="13670" class="Symbol">)</a>
<a id="13672" class="Symbol">...</a> <a id="13676" class="Symbol">|</a> <a id="13678" href="/19.08/Untyped/#12946" class="InductiveConstructor">done</a> <a id="13683" class="Symbol">(</a><a id="13684" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="13686" href="plfa.part2.Untyped.html#13686" class="Bound">NeuL</a><a id="13690" class="Symbol">)</a> <a id="13692" class="Keyword">with</a> <a id="13697" href="plfa.part2.Untyped.html#13064" class="Function">progress</a> <a id="13706" class="Bound">M</a>
<a id="13708" class="Symbol">...</a>    <a id="13715" class="Symbol">|</a> <a id="13717" href="/19.08/Untyped/#12875" class="InductiveConstructor">step</a> <a id="13722" href="plfa.part2.Untyped.html#13722" class="Bound">M—→M′</a>                            <a id="13755" class="Symbol">=</a>  <a id="13758" href="plfa.part2.Untyped.html#12875" class="InductiveConstructor">step</a> <a id="13763" class="Symbol">(</a><a id="13764" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="13767" href="plfa.part2.Untyped.html#13722" class="Bound">M—→M′</a><a id="13772" class="Symbol">)</a>
<a id="13774" class="Symbol">...</a>    <a id="13781" class="Symbol">|</a> <a id="13783" href="/19.08/Untyped/#12946" class="InductiveConstructor">done</a> <a id="13788" href="plfa.part2.Untyped.html#13788" class="Bound">NrmM</a>                             <a id="13821" class="Symbol">=</a>  <a id="13824" href="plfa.part2.Untyped.html#12946" class="InductiveConstructor">done</a> <a id="13829" class="Symbol">(</a><a id="13830" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="13832" class="Bound">NeuL</a> <a id="13837" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="13839" href="plfa.part2.Untyped.html#13788" class="Bound">NrmM</a><a id="13843" class="Symbol">)</a>
</pre><p>We induct on the evidence that the term is well scoped:</p><ul><li>If the term is a variable, then it is in normal form. (This contrasts with previous proofs, where the variable case was ruled out by the restriction to closed terms.)</li><li>If the term is an abstraction, recursively invoke progress on the body. (This contrast with previous proofs, where an abstraction is immediately a value.):<ul><li>If it steps, then the whole term steps via <code class="language-plaintext highlighter-rouge">ζ</code>.</li><li>If it is in normal form, then so is the whole term.</li></ul></li><li>If the term is an application, consider the function subterm:<ul><li>If it is a variable, recursively invoke progress on the argument:<ul><li>If it steps, then the whole term steps via <code class="language-plaintext highlighter-rouge">ξ₂</code>;</li><li>If it is normal, then so is the whole term.</li></ul></li><li>If it is an abstraction, then the whole term steps via <code class="language-plaintext highlighter-rouge">β</code>.</li><li>If it is an application, recursively apply progress to the function subterm:<ul><li>If it steps, then the whole term steps via <code class="language-plaintext highlighter-rouge">ξ₁</code>.</li><li>If it is normal, recursively apply progress to the argument subterm:<ul><li>If it steps, then the whole term steps via <code class="language-plaintext highlighter-rouge">ξ₂</code>.</li><li>If it is normal, then so is the whole term.</li></ul></li></ul></li></ul></li></ul><p>The final equation for progress uses an <em>at pattern</em> of the form <code class="language-plaintext highlighter-rouge">P@Q</code>, which matches only if both pattern <code class="language-plaintext highlighter-rouge">P</code> and pattern <code class="language-plaintext highlighter-rouge">Q</code> match. Character <code class="language-plaintext highlighter-rouge">@</code> is one of the few that Agda doesn’t allow in names, so spaces are not required around it. In this case, the pattern ensures that <code class="language-plaintext highlighter-rouge">L</code> is an application.</p><h2 id="evaluation">Evaluation</h2><p>As previously, progress immediately yields an evaluator.</p><p>Gas is specified by a natural number:</p><pre class="Agda"><a id="15391" class="Keyword">data</a> <a id="Gas"></a><a id="15396" href="/19.08/Untyped/#15396" class="Datatype">Gas</a> <a id="15400" class="Symbol">:</a> <a id="15402" class="PrimitiveType">Set</a> <a id="15406" class="Keyword">where</a>
  <a id="Gas.gas"></a><a id="15414" href="/19.08/Untyped/#15414" class="InductiveConstructor">gas</a> <a id="15418" class="Symbol">:</a> <a id="15420" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="15422" class="Symbol">→</a> <a id="15424" href="plfa.part2.Untyped.html#15396" class="Datatype">Gas</a>
</pre><p>When our evaluator returns a term <code class="language-plaintext highlighter-rouge">N</code>, it will either give evidence that <code class="language-plaintext highlighter-rouge">N</code> is normal or indicate that it ran out of gas:</p><pre class="Agda"><a id="15559" class="Keyword">data</a> <a id="Finished"></a><a id="15564" href="/19.08/Untyped/#15564" class="Datatype">Finished</a> <a id="15573" class="Symbol">{</a><a id="15574" href="plfa.part2.Untyped.html#15574" class="Bound">Γ</a> <a id="15576" href="plfa.part2.Untyped.html#15576" class="Bound">A</a><a id="15577" class="Symbol">}</a> <a id="15579" class="Symbol">(</a><a id="15580" href="plfa.part2.Untyped.html#15580" class="Bound">N</a> <a id="15582" class="Symbol">:</a> <a id="15584" href="plfa.part2.Untyped.html#15574" class="Bound">Γ</a> <a id="15586" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="15588" href="plfa.part2.Untyped.html#15576" class="Bound">A</a><a id="15589" class="Symbol">)</a> <a id="15591" class="Symbol">:</a> <a id="15593" class="PrimitiveType">Set</a> <a id="15597" class="Keyword">where</a>

   <a id="Finished.done"></a><a id="15607" href="/19.08/Untyped/#15607" class="InductiveConstructor">done</a> <a id="15612" class="Symbol">:</a>
       <a id="15621" href="/19.08/Untyped/#7921" class="Datatype">Normal</a> <a id="15628" href="plfa.part2.Untyped.html#15580" class="Bound">N</a>
       <a id="15637" class="Comment">----------</a>
     <a id="15653" class="Symbol">→</a> <a id="15655" href="/19.08/Untyped/#15564" class="Datatype">Finished</a> <a id="15664" href="plfa.part2.Untyped.html#15580" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="15670" href="/19.08/Untyped/#15670" class="InductiveConstructor">out-of-gas</a> <a id="15681" class="Symbol">:</a>
       <a id="15690" class="Comment">----------</a>
       <a id="15708" href="/19.08/Untyped/#15564" class="Datatype">Finished</a> <a id="15717" href="plfa.part2.Untyped.html#15580" class="Bound">N</a>
</pre><p>Given a term <code class="language-plaintext highlighter-rouge">L</code> of type <code class="language-plaintext highlighter-rouge">A</code>, the evaluator will, for some <code class="language-plaintext highlighter-rouge">N</code>, return a reduction sequence from <code class="language-plaintext highlighter-rouge">L</code> to <code class="language-plaintext highlighter-rouge">N</code> and an indication of whether reduction finished:</p><pre class="Agda"><a id="15884" class="Keyword">data</a> <a id="Steps"></a><a id="15889" href="/19.08/Untyped/#15889" class="Datatype">Steps</a> <a id="15895" class="Symbol">:</a> <a id="15897" class="Symbol">∀</a> <a id="15899" class="Symbol">{</a><a id="15900" href="plfa.part2.Untyped.html#15900" class="Bound">Γ</a> <a id="15902" href="plfa.part2.Untyped.html#15902" class="Bound">A</a><a id="15903" class="Symbol">}</a> <a id="15905" class="Symbol">→</a> <a id="15907" href="plfa.part2.Untyped.html#15900" class="Bound">Γ</a> <a id="15909" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="15911" href="plfa.part2.Untyped.html#15902" class="Bound">A</a> <a id="15913" class="Symbol">→</a> <a id="15915" class="PrimitiveType">Set</a> <a id="15919" class="Keyword">where</a>

  <a id="Steps.steps"></a><a id="15928" href="/19.08/Untyped/#15928" class="InductiveConstructor">steps</a> <a id="15934" class="Symbol">:</a> <a id="15936" class="Symbol">∀</a> <a id="15938" class="Symbol">{</a><a id="15939" href="plfa.part2.Untyped.html#15939" class="Bound">Γ</a> <a id="15941" href="plfa.part2.Untyped.html#15941" class="Bound">A</a><a id="15942" class="Symbol">}</a> <a id="15944" class="Symbol">{</a><a id="15945" href="plfa.part2.Untyped.html#15945" class="Bound">L</a> <a id="15947" href="plfa.part2.Untyped.html#15947" class="Bound">N</a> <a id="15949" class="Symbol">:</a> <a id="15951" href="plfa.part2.Untyped.html#15939" class="Bound">Γ</a> <a id="15953" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="15955" href="plfa.part2.Untyped.html#15941" class="Bound">A</a><a id="15956" class="Symbol">}</a>
    <a id="15962" class="Symbol">→</a> <a id="15964" href="/19.08/Untyped/#15945" class="Bound">L</a> <a id="15966" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="15969" href="plfa.part2.Untyped.html#15947" class="Bound">N</a>
    <a id="15975" class="Symbol">→</a> <a id="15977" href="/19.08/Untyped/#15564" class="Datatype">Finished</a> <a id="15986" href="plfa.part2.Untyped.html#15947" class="Bound">N</a>
      <a id="15994" class="Comment">----------</a>
    <a id="16009" class="Symbol">→</a> <a id="16011" href="/19.08/Untyped/#15889" class="Datatype">Steps</a> <a id="16017" href="plfa.part2.Untyped.html#15945" class="Bound">L</a>
</pre><p>The evaluator takes gas and a term and returns the corresponding steps:</p><pre class="Agda"><a id="eval"></a><a id="16099" href="/19.08/Untyped/#16099" class="Function">eval</a> <a id="16104" class="Symbol">:</a> <a id="16106" class="Symbol">∀</a> <a id="16108" class="Symbol">{</a><a id="16109" href="plfa.part2.Untyped.html#16109" class="Bound">Γ</a> <a id="16111" href="plfa.part2.Untyped.html#16111" class="Bound">A</a><a id="16112" class="Symbol">}</a>
  <a id="16116" class="Symbol">→</a> <a id="16118" href="/19.08/Untyped/#15396" class="Datatype">Gas</a>
  <a id="16124" class="Symbol">→</a> <a id="16126" class="Symbol">(</a><a id="16127" href="/19.08/Untyped/#16127" class="Bound">L</a> <a id="16129" class="Symbol">:</a> <a id="16131" href="plfa.part2.Untyped.html#16109" class="Bound">Γ</a> <a id="16133" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="16135" href="plfa.part2.Untyped.html#16111" class="Bound">A</a><a id="16136" class="Symbol">)</a>
    <a id="16142" class="Comment">-----------</a>
  <a id="16156" class="Symbol">→</a> <a id="16158" href="/19.08/Untyped/#15889" class="Datatype">Steps</a> <a id="16164" href="plfa.part2.Untyped.html#16127" class="Bound">L</a>
<a id="16166" href="/19.08/Untyped/#16099" class="Function">eval</a> <a id="16171" class="Symbol">(</a><a id="16172" href="plfa.part2.Untyped.html#15414" class="InductiveConstructor">gas</a> <a id="16176" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="16180" class="Symbol">)</a>    <a id="16185" href="plfa.part2.Untyped.html#16185" class="Bound">L</a>                     <a id="16207" class="Symbol">=</a>  <a id="16210" href="plfa.part2.Untyped.html#15928" class="InductiveConstructor">steps</a> <a id="16216" class="Symbol">(</a><a id="16217" href="plfa.part2.Untyped.html#16185" class="Bound">L</a> <a id="16219" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a><a id="16220" class="Symbol">)</a> <a id="16222" href="plfa.part2.Untyped.html#15670" class="InductiveConstructor">out-of-gas</a>
<a id="16233" href="/19.08/Untyped/#16099" class="Function">eval</a> <a id="16238" class="Symbol">(</a><a id="16239" href="plfa.part2.Untyped.html#15414" class="InductiveConstructor">gas</a> <a id="16243" class="Symbol">(</a><a id="16244" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="16248" href="plfa.part2.Untyped.html#16248" class="Bound">m</a><a id="16249" class="Symbol">))</a> <a id="16252" href="plfa.part2.Untyped.html#16252" class="Bound">L</a> <a id="16254" class="Keyword">with</a> <a id="16259" href="plfa.part2.Untyped.html#13064" class="Function">progress</a> <a id="16268" href="plfa.part2.Untyped.html#16252" class="Bound">L</a>
<a id="16270" class="Symbol">...</a> <a id="16274" class="Symbol">|</a> <a id="16276" href="/19.08/Untyped/#12946" class="InductiveConstructor">done</a> <a id="16281" href="plfa.part2.Untyped.html#16281" class="Bound">NrmL</a>                          <a id="16311" class="Symbol">=</a>  <a id="16314" href="plfa.part2.Untyped.html#15928" class="InductiveConstructor">steps</a> <a id="16320" class="Symbol">(</a><a id="16321" class="Bound">L</a> <a id="16323" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a><a id="16324" class="Symbol">)</a> <a id="16326" class="Symbol">(</a><a id="16327" href="plfa.part2.Untyped.html#15607" class="InductiveConstructor">done</a> <a id="16332" href="plfa.part2.Untyped.html#16281" class="Bound">NrmL</a><a id="16336" class="Symbol">)</a>
<a id="16338" class="Symbol">...</a> <a id="16342" class="Symbol">|</a> <a id="16344" href="/19.08/Untyped/#12875" class="InductiveConstructor">step</a> <a id="16349" class="Symbol">{</a><a id="16350" href="plfa.part2.Untyped.html#16350" class="Bound">M</a><a id="16351" class="Symbol">}</a> <a id="16353" href="plfa.part2.Untyped.html#16353" class="Bound">L—→M</a> <a id="16358" class="Keyword">with</a> <a id="16363" href="plfa.part2.Untyped.html#16099" class="Function">eval</a> <a id="16368" class="Symbol">(</a><a id="16369" href="plfa.part2.Untyped.html#15414" class="InductiveConstructor">gas</a> <a id="16373" class="Bound">m</a><a id="16374" class="Symbol">)</a> <a id="16376" href="plfa.part2.Untyped.html#16350" class="Bound">M</a>
<a id="16378" class="Symbol">...</a>    <a id="16385" class="Symbol">|</a> <a id="16387" href="/19.08/Untyped/#15928" class="InductiveConstructor">steps</a> <a id="16393" href="plfa.part2.Untyped.html#16393" class="Bound">M—↠N</a> <a id="16398" href="plfa.part2.Untyped.html#16398" class="Bound">fin</a>                  <a id="16419" class="Symbol">=</a>  <a id="16422" href="plfa.part2.Untyped.html#15928" class="InductiveConstructor">steps</a> <a id="16428" class="Symbol">(</a><a id="16429" class="Bound">L</a> <a id="16431" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="16435" class="Bound">L—→M</a> <a id="16440" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="16442" href="plfa.part2.Untyped.html#16393" class="Bound">M—↠N</a><a id="16446" class="Symbol">)</a> <a id="16448" href="plfa.part2.Untyped.html#16398" class="Bound">fin</a>
</pre><p>The definition is as before, save that the empty context <code class="language-plaintext highlighter-rouge">∅</code> generalises to an arbitrary context <code class="language-plaintext highlighter-rouge">Γ</code>.</p><h2 id="example">Example</h2><p>We reiterate our previous example. Two plus two is four, with Church numerals:</p><pre class="Agda"><a id="16654" href="/19.08/Untyped/#16654" class="Function">_</a> <a id="16656" class="Symbol">:</a> <a id="16658" href="plfa.part2.Untyped.html#16099" class="Function">eval</a> <a id="16663" class="Symbol">(</a><a id="16664" href="plfa.part2.Untyped.html#15414" class="InductiveConstructor">gas</a> <a id="16668" class="Number">100</a><a id="16671" class="Symbol">)</a> <a id="16673" href="plfa.part2.Untyped.html#5437" class="Function">2+2ᶜ</a> <a id="16678" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a>
  <a id="16682" href="/19.08/Untyped/#15928" class="InductiveConstructor">steps</a>
   <a id="16691" class="Symbol">((</a><a id="16693" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
     <a id="16700" class="Symbol">(</a><a id="16701" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
      <a id="16709" class="Symbol">(</a><a id="16710" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
       <a id="16719" class="Symbol">(</a><a id="16720" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
        <a id="16730" class="Symbol">(</a><a id="16731" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="16733" class="Symbol">(</a><a id="16734" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16736" class="Symbol">(</a><a id="16737" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16739" class="Symbol">(</a><a id="16740" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16742" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16743" class="Symbol">))))</a> <a id="16748" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16750" class="Symbol">(</a><a id="16751" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16753" class="Symbol">(</a><a id="16754" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16756" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16757" class="Symbol">))</a> <a id="16760" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
        <a id="16770" class="Symbol">((</a><a id="16772" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="16774" class="Symbol">(</a><a id="16775" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16777" class="Symbol">(</a><a id="16778" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16780" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16781" class="Symbol">)))</a> <a id="16785" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16787" class="Symbol">(</a><a id="16788" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16790" class="Symbol">(</a><a id="16791" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16793" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16794" class="Symbol">))</a> <a id="16797" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16799" class="Symbol">(</a><a id="16800" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16802" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16803" class="Symbol">))))))</a>
    <a id="16814" href="/19.08/Untyped/#4442" class="InductiveConstructor Operator">·</a> <a id="16816" class="Symbol">(</a><a id="16817" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="16819" class="Symbol">(</a><a id="16820" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="16822" class="Symbol">(</a><a id="16823" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16825" class="Symbol">(</a><a id="16826" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16828" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16829" class="Symbol">))</a> <a id="16832" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16834" class="Symbol">((</a><a id="16836" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16838" class="Symbol">(</a><a id="16839" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16841" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16842" class="Symbol">))</a> <a id="16845" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16847" class="Symbol">(</a><a id="16848" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16850" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16851" class="Symbol">))))</a>
    <a id="16860" href="/19.08/Untyped/#4442" class="InductiveConstructor Operator">·</a> <a id="16862" class="Symbol">(</a><a id="16863" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="16865" class="Symbol">(</a><a id="16866" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="16868" class="Symbol">(</a><a id="16869" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16871" class="Symbol">(</a><a id="16872" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16874" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16875" class="Symbol">))</a> <a id="16878" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16880" class="Symbol">((</a><a id="16882" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16884" class="Symbol">(</a><a id="16885" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16887" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16888" class="Symbol">))</a> <a id="16891" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16893" class="Symbol">(</a><a id="16894" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16896" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16897" class="Symbol">))))</a>
   <a id="16905" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="16909" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="16912" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a> <a id="16914" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="16920" class="Symbol">(</a><a id="16921" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
     <a id="16928" class="Symbol">(</a><a id="16929" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
      <a id="16937" class="Symbol">(</a><a id="16938" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
       <a id="16947" class="Symbol">(</a><a id="16948" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="16950" class="Symbol">(</a><a id="16951" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="16953" class="Symbol">(</a><a id="16954" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16956" class="Symbol">(</a><a id="16957" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16959" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16960" class="Symbol">))</a> <a id="16963" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16965" class="Symbol">((</a><a id="16967" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16969" class="Symbol">(</a><a id="16970" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16972" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16973" class="Symbol">))</a> <a id="16976" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16978" class="Symbol">(</a><a id="16979" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16981" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16982" class="Symbol">))))</a> <a id="16987" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="16989" class="Symbol">(</a><a id="16990" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="16992" class="Symbol">(</a><a id="16993" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="16995" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="16996" class="Symbol">))</a> <a id="16999" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
       <a id="17008" class="Symbol">((</a><a id="17010" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="17012" class="Symbol">(</a><a id="17013" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17015" class="Symbol">(</a><a id="17016" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17018" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17019" class="Symbol">)))</a> <a id="17023" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17025" class="Symbol">(</a><a id="17026" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17028" class="Symbol">(</a><a id="17029" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17031" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17032" class="Symbol">))</a> <a id="17035" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17037" class="Symbol">(</a><a id="17038" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17040" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17041" class="Symbol">)))))</a>
    <a id="17051" href="/19.08/Untyped/#4442" class="InductiveConstructor Operator">·</a> <a id="17053" class="Symbol">(</a><a id="17054" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17056" class="Symbol">(</a><a id="17057" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17059" class="Symbol">(</a><a id="17060" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17062" class="Symbol">(</a><a id="17063" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17065" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17066" class="Symbol">))</a> <a id="17069" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17071" class="Symbol">((</a><a id="17073" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17075" class="Symbol">(</a><a id="17076" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17078" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17079" class="Symbol">))</a> <a id="17082" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17084" class="Symbol">(</a><a id="17085" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17087" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17088" class="Symbol">))))</a>
   <a id="17096" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="17100" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a> <a id="17102" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="17108" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
    <a id="17114" class="Symbol">(</a><a id="17115" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
     <a id="17122" class="Symbol">(</a><a id="17123" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17125" class="Symbol">(</a><a id="17126" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17128" class="Symbol">(</a><a id="17129" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17131" class="Symbol">(</a><a id="17132" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17134" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17135" class="Symbol">))</a> <a id="17138" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17140" class="Symbol">((</a><a id="17142" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17144" class="Symbol">(</a><a id="17145" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17147" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17148" class="Symbol">))</a> <a id="17151" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17153" class="Symbol">(</a><a id="17154" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17156" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17157" class="Symbol">))))</a> <a id="17162" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17164" class="Symbol">(</a><a id="17165" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17167" class="Symbol">(</a><a id="17168" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17170" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17171" class="Symbol">))</a> <a id="17174" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
     <a id="17181" class="Symbol">((</a><a id="17183" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17185" class="Symbol">(</a><a id="17186" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17188" class="Symbol">(</a><a id="17189" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17191" class="Symbol">(</a><a id="17192" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17194" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17195" class="Symbol">))</a> <a id="17198" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17200" class="Symbol">((</a><a id="17202" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17204" class="Symbol">(</a><a id="17205" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17207" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17208" class="Symbol">))</a> <a id="17211" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17213" class="Symbol">(</a><a id="17214" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17216" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17217" class="Symbol">))))</a> <a id="17222" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17224" class="Symbol">(</a><a id="17225" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17227" class="Symbol">(</a><a id="17228" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17230" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17231" class="Symbol">))</a> <a id="17234" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17236" class="Symbol">(</a><a id="17237" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17239" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17240" class="Symbol">)))</a>
   <a id="17247" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="17251" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17253" class="Symbol">(</a><a id="17254" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17256" class="Symbol">(</a><a id="17257" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="17260" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="17261" class="Symbol">))</a> <a id="17264" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="17270" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
    <a id="17276" class="Symbol">(</a><a id="17277" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
     <a id="17284" class="Symbol">(</a><a id="17285" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17287" class="Symbol">(</a><a id="17288" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17290" class="Symbol">(</a><a id="17291" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17293" class="Symbol">(</a><a id="17294" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17296" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17297" class="Symbol">)))</a> <a id="17301" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17303" class="Symbol">((</a><a id="17305" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17307" class="Symbol">(</a><a id="17308" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17310" class="Symbol">(</a><a id="17311" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17313" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17314" class="Symbol">)))</a> <a id="17318" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17320" class="Symbol">(</a><a id="17321" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17323" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17324" class="Symbol">)))</a> <a id="17328" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
     <a id="17335" class="Symbol">((</a><a id="17337" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17339" class="Symbol">(</a><a id="17340" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17342" class="Symbol">(</a><a id="17343" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17345" class="Symbol">(</a><a id="17346" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17348" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17349" class="Symbol">))</a> <a id="17352" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17354" class="Symbol">((</a><a id="17356" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17358" class="Symbol">(</a><a id="17359" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17361" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17362" class="Symbol">))</a> <a id="17365" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17367" class="Symbol">(</a><a id="17368" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17370" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17371" class="Symbol">))))</a> <a id="17376" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17378" class="Symbol">(</a><a id="17379" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17381" class="Symbol">(</a><a id="17382" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17384" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17385" class="Symbol">))</a> <a id="17388" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17390" class="Symbol">(</a><a id="17391" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17393" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17394" class="Symbol">)))</a>
   <a id="17401" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="17405" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17407" class="Symbol">(</a><a id="17408" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17410" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="17411" class="Symbol">)</a> <a id="17413" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="17419" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
    <a id="17425" class="Symbol">(</a><a id="17426" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
     <a id="17433" class="Symbol">(</a><a id="17434" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="17436" class="Symbol">(</a><a id="17437" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17439" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17440" class="Symbol">))</a> <a id="17443" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
     <a id="17450" class="Symbol">((</a><a id="17452" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="17454" class="Symbol">(</a><a id="17455" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17457" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17458" class="Symbol">))</a> <a id="17461" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
      <a id="17469" class="Symbol">((</a><a id="17471" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17473" class="Symbol">(</a><a id="17474" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17476" class="Symbol">(</a><a id="17477" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17479" class="Symbol">(</a><a id="17480" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17482" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17483" class="Symbol">))</a> <a id="17486" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17488" class="Symbol">((</a><a id="17490" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17492" class="Symbol">(</a><a id="17493" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17495" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17496" class="Symbol">))</a> <a id="17499" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17501" class="Symbol">(</a><a id="17502" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17504" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17505" class="Symbol">))))</a> <a id="17510" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17512" class="Symbol">(</a><a id="17513" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17515" class="Symbol">(</a><a id="17516" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17518" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17519" class="Symbol">))</a> <a id="17522" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17524" class="Symbol">(</a><a id="17525" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17527" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17528" class="Symbol">))))</a>
   <a id="17536" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="17540" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17542" class="Symbol">(</a><a id="17543" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17545" class="Symbol">(</a><a id="17546" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="17549" class="Symbol">(</a><a id="17550" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="17553" class="Symbol">(</a><a id="17554" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="17557" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="17558" class="Symbol">))))</a> <a id="17563" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="17569" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
    <a id="17575" class="Symbol">(</a><a id="17576" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a>
     <a id="17583" class="Symbol">(</a><a id="17584" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="17586" class="Symbol">(</a><a id="17587" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17589" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17590" class="Symbol">))</a> <a id="17593" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
     <a id="17600" class="Symbol">((</a><a id="17602" href="/19.08/Untyped/#4330" class="InductiveConstructor Operator">`</a> <a id="17604" class="Symbol">(</a><a id="17605" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17607" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17608" class="Symbol">))</a> <a id="17611" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a>
      <a id="17619" class="Symbol">((</a><a id="17621" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17623" class="Symbol">(</a><a id="17624" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17626" class="Symbol">(</a><a id="17627" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17629" class="Symbol">(</a><a id="17630" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17632" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17633" class="Symbol">)))</a> <a id="17637" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17639" class="Symbol">((</a><a id="17641" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17643" class="Symbol">(</a><a id="17644" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17646" class="Symbol">(</a><a id="17647" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17649" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17650" class="Symbol">)))</a> <a id="17654" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17656" class="Symbol">(</a><a id="17657" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17659" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17660" class="Symbol">)))</a> <a id="17664" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17666" class="Symbol">(</a><a id="17667" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17669" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17670" class="Symbol">))))</a>
   <a id="17678" href="/19.08/Untyped/#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="17682" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17684" class="Symbol">(</a><a id="17685" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="17687" class="Symbol">(</a><a id="17688" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="17691" class="Symbol">(</a><a id="17692" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="17695" href="plfa.part2.Untyped.html#10377" class="InductiveConstructor">β</a><a id="17696" class="Symbol">)))</a> <a id="17700" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a>
    <a id="17706" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17708" class="Symbol">(</a><a id="17709" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="17711" class="Symbol">(</a><a id="17712" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17714" class="Symbol">(</a><a id="17715" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17717" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17718" class="Symbol">))</a> <a id="17721" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17723" class="Symbol">((</a><a id="17725" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17727" class="Symbol">(</a><a id="17728" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17730" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17731" class="Symbol">))</a> <a id="17734" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17736" class="Symbol">((</a><a id="17738" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17740" class="Symbol">(</a><a id="17741" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17743" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17744" class="Symbol">))</a> <a id="17747" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17749" class="Symbol">((</a><a id="17751" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17753" class="Symbol">(</a><a id="17754" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17756" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17757" class="Symbol">))</a> <a id="17760" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="17762" class="Symbol">(</a><a id="17763" href="plfa.part2.Untyped.html#4330" class="InductiveConstructor Operator">`</a> <a id="17765" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17766" class="Symbol">)))))</a>
   <a id="17775" href="/19.08/Untyped/#11317" class="InductiveConstructor Operator">∎</a><a id="17776" class="Symbol">)</a>
   <a id="17781" class="Symbol">(</a><a id="17782" href="/19.08/Untyped/#15607" class="InductiveConstructor">done</a>
    <a id="17791" class="Symbol">(</a><a id="17792" href="/19.08/Untyped/#8606" class="InductiveConstructor Operator">ƛ</a>
     <a id="17799" class="Symbol">(</a><a id="17800" href="/19.08/Untyped/#8606" class="InductiveConstructor Operator">ƛ</a>
      <a id="17808" class="Symbol">(</a><a id="17809" href="/19.08/Untyped/#8531" class="InductiveConstructor Operator">′</a>
       <a id="17818" class="Symbol">(</a><a id="17819" href="/19.08/Untyped/#8169" class="InductiveConstructor Operator">`</a> <a id="17821" class="Symbol">(</a><a id="17822" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17824" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17825" class="Symbol">))</a> <a id="17828" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a>
       <a id="17837" class="Symbol">(</a><a id="17838" href="/19.08/Untyped/#8531" class="InductiveConstructor Operator">′</a> <a id="17840" class="Symbol">(</a><a id="17841" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="17843" class="Symbol">(</a><a id="17844" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17846" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17847" class="Symbol">))</a> <a id="17850" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="17852" class="Symbol">(</a><a id="17853" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="17855" class="Symbol">(</a><a id="17856" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="17858" class="Symbol">(</a><a id="17859" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17861" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17862" class="Symbol">))</a> <a id="17865" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="17867" class="Symbol">(</a><a id="17868" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="17870" class="Symbol">(</a><a id="17871" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="17873" class="Symbol">(</a><a id="17874" href="plfa.part2.Untyped.html#3602" class="InductiveConstructor Operator">S</a> <a id="17876" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17877" class="Symbol">))</a> <a id="17880" href="plfa.part2.Untyped.html#8238" class="InductiveConstructor Operator">·</a> <a id="17882" class="Symbol">(</a><a id="17883" href="plfa.part2.Untyped.html#8531" class="InductiveConstructor Operator">′</a> <a id="17885" class="Symbol">(</a><a id="17886" href="plfa.part2.Untyped.html#8169" class="InductiveConstructor Operator">`</a> <a id="17888" href="plfa.part2.Untyped.html#3557" class="InductiveConstructor">Z</a><a id="17889" class="Symbol">)))))))))</a>
<a id="17899" class="Symbol">_</a> <a id="17901" class="Symbol">=</a> <a id="17903" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre><h2 id="naturals-and-fixpoint">Naturals and fixpoint</h2><p>We could simulate naturals using Church numerals, but computing predecessor is tricky and expensive. Instead, we use a different representation, called Scott numerals, where a number is essentially defined by the expression that corresponds to its own case statement.</p><p>Recall that Church numerals apply a given function for the corresponding number of times. Using named terms, we represent the first three Church numerals as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zero  =  ƛ s ⇒ ƛ z ⇒ z
one   =  ƛ s ⇒ ƛ z ⇒ s · z
two   =  ƛ s ⇒ ƛ z ⇒ s · (s · z)
</code></pre></div></div><p>In contrast, for Scott numerals, we represent the first three naturals as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zero = ƛ s ⇒ ƛ z ⇒ z
one  = ƛ s ⇒ ƛ z ⇒ s · zero
two  = ƛ s ⇒ ƛ z ⇒ s · one
</code></pre></div></div><p>Each representation expects two arguments, one corresponding to the successor branch of the case (it expects an additional argument, the predecessor of the current argument) and one corresponding to the zero branch of the case. (The cases could be in either order. We put the successor case first to ease comparison with Church numerals.)</p><p>Here is the representation of naturals encoded with de Bruijn indexes:</p><pre class="Agda"><a id="`zero"></a><a id="19062" href="/19.08/Untyped/#19062" class="Function">`zero</a> <a id="19068" class="Symbol">:</a> <a id="19070" class="Symbol">∀</a> <a id="19072" class="Symbol">{</a><a id="19073" href="plfa.part2.Untyped.html#19073" class="Bound">Γ</a><a id="19074" class="Symbol">}</a> <a id="19076" class="Symbol">→</a> <a id="19078" class="Symbol">(</a><a id="19079" href="plfa.part2.Untyped.html#19073" class="Bound">Γ</a> <a id="19081" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19083" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19084" class="Symbol">)</a>
<a id="19086" href="/19.08/Untyped/#19062" class="Function">`zero</a> <a id="19092" class="Symbol">=</a> <a id="19094" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19096" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19098" class="Symbol">(</a><a id="19099" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19101" class="Number">0</a><a id="19102" class="Symbol">)</a>

<a id="`suc_"></a><a id="19105" href="/19.08/Untyped/#19105" class="Function Operator">`suc_</a> <a id="19111" class="Symbol">:</a> <a id="19113" class="Symbol">∀</a> <a id="19115" class="Symbol">{</a><a id="19116" href="plfa.part2.Untyped.html#19116" class="Bound">Γ</a><a id="19117" class="Symbol">}</a> <a id="19119" class="Symbol">→</a> <a id="19121" class="Symbol">(</a><a id="19122" href="plfa.part2.Untyped.html#19116" class="Bound">Γ</a> <a id="19124" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19126" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19127" class="Symbol">)</a> <a id="19129" class="Symbol">→</a> <a id="19131" class="Symbol">(</a><a id="19132" href="plfa.part2.Untyped.html#19116" class="Bound">Γ</a> <a id="19134" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19136" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19137" class="Symbol">)</a>
<a id="19139" href="/19.08/Untyped/#19105" class="Function Operator">`suc_</a> <a id="19145" href="plfa.part2.Untyped.html#19145" class="Bound">M</a>  <a id="19148" class="Symbol">=</a> <a id="19150" class="Symbol">(</a><a id="19151" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19153" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19155" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19157" class="Symbol">(</a><a id="19158" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19160" class="Number">1</a> <a id="19162" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19164" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19166" class="Number">2</a><a id="19167" class="Symbol">))</a> <a id="19170" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19172" href="plfa.part2.Untyped.html#19145" class="Bound">M</a>

<a id="case"></a><a id="19175" href="/19.08/Untyped/#19175" class="Function">case</a> <a id="19180" class="Symbol">:</a> <a id="19182" class="Symbol">∀</a> <a id="19184" class="Symbol">{</a><a id="19185" href="plfa.part2.Untyped.html#19185" class="Bound">Γ</a><a id="19186" class="Symbol">}</a> <a id="19188" class="Symbol">→</a> <a id="19190" class="Symbol">(</a><a id="19191" href="plfa.part2.Untyped.html#19185" class="Bound">Γ</a> <a id="19193" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19195" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19196" class="Symbol">)</a> <a id="19198" class="Symbol">→</a> <a id="19200" class="Symbol">(</a><a id="19201" href="plfa.part2.Untyped.html#19185" class="Bound">Γ</a> <a id="19203" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19205" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19206" class="Symbol">)</a> <a id="19208" class="Symbol">→</a> <a id="19210" class="Symbol">(</a><a id="19211" href="plfa.part2.Untyped.html#19185" class="Bound">Γ</a> <a id="19213" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="19215" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="19217" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19219" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19220" class="Symbol">)</a>  <a id="19223" class="Symbol">→</a> <a id="19225" class="Symbol">(</a><a id="19226" href="plfa.part2.Untyped.html#19185" class="Bound">Γ</a> <a id="19228" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19230" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19231" class="Symbol">)</a>
<a id="19233" href="/19.08/Untyped/#19175" class="Function">case</a> <a id="19238" href="plfa.part2.Untyped.html#19238" class="Bound">L</a> <a id="19240" href="plfa.part2.Untyped.html#19240" class="Bound">M</a> <a id="19242" href="plfa.part2.Untyped.html#19242" class="Bound">N</a> <a id="19244" class="Symbol">=</a> <a id="19246" href="plfa.part2.Untyped.html#19238" class="Bound">L</a> <a id="19248" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19250" class="Symbol">(</a><a id="19251" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19253" href="plfa.part2.Untyped.html#19242" class="Bound">N</a><a id="19254" class="Symbol">)</a> <a id="19256" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19258" href="plfa.part2.Untyped.html#19240" class="Bound">M</a>
</pre><p>Here we have been careful to retain the exact form of our previous definitions. The successor branch expects an additional variable to be in scope (as indicated by its type), so it is converted to an ordinary term using lambda abstraction.</p><p>We can also define fixpoint. Using named terms, we define:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>μ f = (ƛ x ⇒ f · (x · x)) · (ƛ x ⇒ f · (x · x))
</code></pre></div></div><p>This works because:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  μ f
≡
  (ƛ x ⇒ f · (x · x)) · (ƛ x ⇒ f · (x · x))
—→
  f · ((ƛ x ⇒ f · (x · x)) · (ƛ x ⇒ f · (x · x)))
≡
  f · (μ f)
</code></pre></div></div><p>With de Bruijn indices, we have the following:</p><pre class="Agda"><a id="μ_"></a><a id="19840" href="/19.08/Untyped/#19840" class="Function Operator">μ_</a> <a id="19843" class="Symbol">:</a> <a id="19845" class="Symbol">∀</a> <a id="19847" class="Symbol">{</a><a id="19848" href="plfa.part2.Untyped.html#19848" class="Bound">Γ</a><a id="19849" class="Symbol">}</a> <a id="19851" class="Symbol">→</a> <a id="19853" class="Symbol">(</a><a id="19854" href="plfa.part2.Untyped.html#19848" class="Bound">Γ</a> <a id="19856" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="19858" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="19860" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19862" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19863" class="Symbol">)</a> <a id="19865" class="Symbol">→</a> <a id="19867" class="Symbol">(</a><a id="19868" href="plfa.part2.Untyped.html#19848" class="Bound">Γ</a> <a id="19870" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="19872" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="19873" class="Symbol">)</a>
<a id="19875" href="/19.08/Untyped/#19840" class="Function Operator">μ</a> <a id="19877" href="plfa.part2.Untyped.html#19877" class="Bound">N</a>  <a id="19880" class="Symbol">=</a>  <a id="19883" class="Symbol">(</a><a id="19884" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19886" class="Symbol">((</a><a id="19888" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19890" class="Symbol">(</a><a id="19891" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19893" class="Number">1</a> <a id="19895" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19897" class="Symbol">(</a><a id="19898" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19900" class="Number">0</a> <a id="19902" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19904" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19906" class="Number">0</a><a id="19907" class="Symbol">)))</a> <a id="19911" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19913" class="Symbol">(</a><a id="19914" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19916" class="Symbol">(</a><a id="19917" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19919" class="Number">1</a> <a id="19921" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19923" class="Symbol">(</a><a id="19924" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19926" class="Number">0</a> <a id="19928" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19930" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="19932" class="Number">0</a><a id="19933" class="Symbol">)))))</a> <a id="19939" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="19941" class="Symbol">(</a><a id="19942" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="19944" href="plfa.part2.Untyped.html#19877" class="Bound">N</a><a id="19945" class="Symbol">)</a>
</pre><p>The argument to fixpoint is treated similarly to the successor branch of case.</p><p>We can now define two plus two exactly as before:</p><pre class="Agda"><a id="20085" class="Keyword">infix</a> <a id="20091" class="Number">5</a> <a id="20093" href="/19.08/Untyped/#19840" class="Function Operator">μ_</a>

<a id="two"></a><a id="20097" href="/19.08/Untyped/#20097" class="Function">two</a> <a id="20101" class="Symbol">:</a> <a id="20103" class="Symbol">∀</a> <a id="20105" class="Symbol">{</a><a id="20106" href="plfa.part2.Untyped.html#20106" class="Bound">Γ</a><a id="20107" class="Symbol">}</a> <a id="20109" class="Symbol">→</a> <a id="20111" href="plfa.part2.Untyped.html#20106" class="Bound">Γ</a> <a id="20113" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="20115" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="20117" href="/19.08/Untyped/#20097" class="Function">two</a> <a id="20121" class="Symbol">=</a> <a id="20123" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20128" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20133" href="plfa.part2.Untyped.html#19062" class="Function">`zero</a>

<a id="four"></a><a id="20140" href="/19.08/Untyped/#20140" class="Function">four</a> <a id="20145" class="Symbol">:</a> <a id="20147" class="Symbol">∀</a> <a id="20149" class="Symbol">{</a><a id="20150" href="plfa.part2.Untyped.html#20150" class="Bound">Γ</a><a id="20151" class="Symbol">}</a> <a id="20153" class="Symbol">→</a> <a id="20155" href="plfa.part2.Untyped.html#20150" class="Bound">Γ</a> <a id="20157" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="20159" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="20161" href="/19.08/Untyped/#20140" class="Function">four</a> <a id="20166" class="Symbol">=</a> <a id="20168" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20173" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20178" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20183" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20188" href="plfa.part2.Untyped.html#19062" class="Function">`zero</a>

<a id="plus"></a><a id="20195" href="/19.08/Untyped/#20195" class="Function">plus</a> <a id="20200" class="Symbol">:</a> <a id="20202" class="Symbol">∀</a> <a id="20204" class="Symbol">{</a><a id="20205" href="plfa.part2.Untyped.html#20205" class="Bound">Γ</a><a id="20206" class="Symbol">}</a> <a id="20208" class="Symbol">→</a> <a id="20210" href="plfa.part2.Untyped.html#20205" class="Bound">Γ</a> <a id="20212" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="20214" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a>
<a id="20216" href="/19.08/Untyped/#20195" class="Function">plus</a> <a id="20221" class="Symbol">=</a> <a id="20223" href="plfa.part2.Untyped.html#19840" class="Function Operator">μ</a> <a id="20225" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="20227" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="20229" class="Symbol">(</a><a id="20230" href="plfa.part2.Untyped.html#19175" class="Function">case</a> <a id="20235" class="Symbol">(</a><a id="20236" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="20238" class="Number">1</a><a id="20239" class="Symbol">)</a> <a id="20241" class="Symbol">(</a><a id="20242" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="20244" class="Number">0</a><a id="20245" class="Symbol">)</a> <a id="20247" class="Symbol">(</a><a id="20248" href="plfa.part2.Untyped.html#19105" class="Function Operator">`suc</a> <a id="20253" class="Symbol">(</a><a id="20254" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="20256" class="Number">3</a> <a id="20258" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="20260" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="20262" class="Number">0</a> <a id="20264" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="20266" href="plfa.part2.Untyped.html#5111" class="Function Operator">#</a> <a id="20268" class="Number">1</a><a id="20269" class="Symbol">)))</a>
</pre><p>Because <code class="language-plaintext highlighter-rouge">`suc</code> is now a defined term rather than primitive, it is no longer the case that <code class="language-plaintext highlighter-rouge">plus · two · two</code> reduces to <code class="language-plaintext highlighter-rouge">four</code>, but they do both reduce to the same normal term.</p><h4 id="exercise-plus-eval-practice">Exercise <code class="language-plaintext highlighter-rouge">plus-eval</code> (practice)</h4><p>Use the evaluator to confirm that <code class="language-plaintext highlighter-rouge">plus · two · two</code> and <code class="language-plaintext highlighter-rouge">four</code> normalise to the same term.</p><pre class="Agda"><a id="20594" class="Comment">-- Your code goes here</a>
</pre><h4 id="exercise-multiplication-untyped-recommended">Exercise <code class="language-plaintext highlighter-rouge">multiplication-untyped</code> (recommended)</h4><p>Use the encodings above to translate your definition of multiplication from previous chapters with the Scott representation and the encoding of the fixpoint operator. Confirm that two times two is four.</p><pre class="Agda"><a id="20884" class="Comment">-- Your code goes here</a>
</pre><h4 id="exercise-encode-more-stretch">Exercise <code class="language-plaintext highlighter-rouge">encode-more</code> (stretch)</h4><p>Along the lines above, encode all of the constructs of Chapter <a href="/19.08/More/">More</a>, save for primitive numbers, in the untyped lambda calculus.</p><pre class="Agda"><a id="21113" class="Comment">-- Your code goes here</a>
</pre><h2 id="multi-step-reduction-is-transitive">Multi-step reduction is transitive</h2><p>In our formulation of the reflexive transitive closure of reduction, i.e., the <code class="language-plaintext highlighter-rouge">—↠</code> relation, there is not an explicit rule for transitivity. Instead the relation mimics the structure of lists by providing a case for an empty reduction sequence and a case for adding one reduction to the front of a reduction sequence. The following is the proof of transitivity, which has the same structure as the append function <code class="language-plaintext highlighter-rouge">_++_</code> on lists.</p><pre class="Agda"><a id="—↠-trans"></a><a id="21619" href="/19.08/Untyped/#21619" class="Function">—↠-trans</a> <a id="21628" class="Symbol">:</a> <a id="21630" class="Symbol">∀{</a><a id="21632" href="plfa.part2.Untyped.html#21632" class="Bound">Γ</a><a id="21633" class="Symbol">}{</a><a id="21635" href="plfa.part2.Untyped.html#21635" class="Bound">A</a><a id="21636" class="Symbol">}{</a><a id="21638" href="plfa.part2.Untyped.html#21638" class="Bound">L</a> <a id="21640" href="plfa.part2.Untyped.html#21640" class="Bound">M</a> <a id="21642" href="plfa.part2.Untyped.html#21642" class="Bound">N</a> <a id="21644" class="Symbol">:</a> <a id="21646" href="plfa.part2.Untyped.html#21632" class="Bound">Γ</a> <a id="21648" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="21650" href="plfa.part2.Untyped.html#21635" class="Bound">A</a><a id="21651" class="Symbol">}</a>
         <a id="21662" class="Symbol">→</a> <a id="21664" href="/19.08/Untyped/#21638" class="Bound">L</a> <a id="21666" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="21669" href="plfa.part2.Untyped.html#21640" class="Bound">M</a>
         <a id="21680" class="Symbol">→</a> <a id="21682" href="/19.08/Untyped/#21640" class="Bound">M</a> <a id="21684" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="21687" href="plfa.part2.Untyped.html#21642" class="Bound">N</a>
         <a id="21698" class="Symbol">→</a> <a id="21700" href="/19.08/Untyped/#21638" class="Bound">L</a> <a id="21702" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="21705" href="plfa.part2.Untyped.html#21642" class="Bound">N</a>
<a id="21707" href="/19.08/Untyped/#21619" class="Function">—↠-trans</a> <a id="21716" class="Symbol">(</a><a id="21717" href="plfa.part2.Untyped.html#21717" class="Bound">M</a> <a id="21719" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a><a id="21720" class="Symbol">)</a> <a id="21722" href="plfa.part2.Untyped.html#21722" class="Bound">mn</a> <a id="21725" class="Symbol">=</a> <a id="21727" href="plfa.part2.Untyped.html#21722" class="Bound">mn</a>
<a id="21730" href="/19.08/Untyped/#21619" class="Function">—↠-trans</a> <a id="21739" class="Symbol">(</a><a id="21740" href="plfa.part2.Untyped.html#21740" class="Bound">L</a> <a id="21742" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="21746" href="plfa.part2.Untyped.html#21746" class="Bound">r</a> <a id="21748" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="21750" href="plfa.part2.Untyped.html#21750" class="Bound">lm</a><a id="21752" class="Symbol">)</a> <a id="21754" href="plfa.part2.Untyped.html#21754" class="Bound">mn</a> <a id="21757" class="Symbol">=</a> <a id="21759" href="plfa.part2.Untyped.html#21740" class="Bound">L</a> <a id="21761" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="21765" href="plfa.part2.Untyped.html#21746" class="Bound">r</a> <a id="21767" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="21769" class="Symbol">(</a><a id="21770" href="plfa.part2.Untyped.html#21619" class="Function">—↠-trans</a> <a id="21779" href="plfa.part2.Untyped.html#21750" class="Bound">lm</a> <a id="21782" href="plfa.part2.Untyped.html#21754" class="Bound">mn</a><a id="21784" class="Symbol">)</a>
</pre><p>The following notation makes it convenient to employ transitivity of <code class="language-plaintext highlighter-rouge">—↠</code>.</p><pre class="Agda"><a id="21871" class="Keyword">infixr</a> <a id="21878" class="Number">2</a> <a id="21880" href="/19.08/Untyped/#21889" class="Function Operator">_—↠⟨_⟩_</a>

<a id="_—↠⟨_⟩_"></a><a id="21889" href="/19.08/Untyped/#21889" class="Function Operator">_—↠⟨_⟩_</a> <a id="21897" class="Symbol">:</a> <a id="21899" class="Symbol">∀</a> <a id="21901" class="Symbol">{</a><a id="21902" href="plfa.part2.Untyped.html#21902" class="Bound">Γ</a> <a id="21904" href="plfa.part2.Untyped.html#21904" class="Bound">A</a><a id="21905" class="Symbol">}</a> <a id="21907" class="Symbol">(</a><a id="21908" href="plfa.part2.Untyped.html#21908" class="Bound">L</a> <a id="21910" class="Symbol">:</a> <a id="21912" href="plfa.part2.Untyped.html#21902" class="Bound">Γ</a> <a id="21914" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="21916" href="plfa.part2.Untyped.html#21904" class="Bound">A</a><a id="21917" class="Symbol">)</a> <a id="21919" class="Symbol">{</a><a id="21920" href="plfa.part2.Untyped.html#21920" class="Bound">M</a> <a id="21922" href="plfa.part2.Untyped.html#21922" class="Bound">N</a> <a id="21924" class="Symbol">:</a> <a id="21926" href="plfa.part2.Untyped.html#21902" class="Bound">Γ</a> <a id="21928" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="21930" href="plfa.part2.Untyped.html#21904" class="Bound">A</a><a id="21931" class="Symbol">}</a>
    <a id="21937" class="Symbol">→</a> <a id="21939" href="/19.08/Untyped/#21908" class="Bound">L</a> <a id="21941" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="21944" href="plfa.part2.Untyped.html#21920" class="Bound">M</a>
    <a id="21950" class="Symbol">→</a> <a id="21952" href="/19.08/Untyped/#21920" class="Bound">M</a> <a id="21954" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="21957" href="plfa.part2.Untyped.html#21922" class="Bound">N</a>
      <a id="21965" class="Comment">---------</a>
    <a id="21979" class="Symbol">→</a> <a id="21981" href="/19.08/Untyped/#21908" class="Bound">L</a> <a id="21983" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="21986" href="plfa.part2.Untyped.html#21922" class="Bound">N</a>
<a id="21988" href="/19.08/Untyped/#21988" class="Bound">L</a> <a id="21990" href="plfa.part2.Untyped.html#21889" class="Function Operator">—↠⟨</a> <a id="21994" href="plfa.part2.Untyped.html#21994" class="Bound">L—↠M</a> <a id="21999" href="plfa.part2.Untyped.html#21889" class="Function Operator">⟩</a> <a id="22001" href="plfa.part2.Untyped.html#22001" class="Bound">M—↠N</a> <a id="22006" class="Symbol">=</a> <a id="22008" href="plfa.part2.Untyped.html#21619" class="Function">—↠-trans</a> <a id="22017" href="plfa.part2.Untyped.html#21994" class="Bound">L—↠M</a> <a id="22022" href="plfa.part2.Untyped.html#22001" class="Bound">M—↠N</a>
</pre><h2 id="multi-step-reduction-is-a-congruence">Multi-step reduction is a congruence</h2><p>Recall from Chapter <a href="/19.08/Induction/">Induction</a> that a relation <code class="language-plaintext highlighter-rouge">R</code> is a <em>congruence</em> for a given function <code class="language-plaintext highlighter-rouge">f</code> if it is preserved by that function, i.e., if <code class="language-plaintext highlighter-rouge">R x y</code> then <code class="language-plaintext highlighter-rouge">R (f x) (f y)</code>. The term constructors <code class="language-plaintext highlighter-rouge">ƛ_</code> and <code class="language-plaintext highlighter-rouge">_·_</code> are functions, and so the notion of congruence applies to them as well. Furthermore, when a relation is a congruence for all of the term constructors, we say that the relation is a congruence for the language in question, in this case the untyped lambda calculus.</p><p>The rules <code class="language-plaintext highlighter-rouge">ξ₁</code>, <code class="language-plaintext highlighter-rouge">ξ₂</code>, and <code class="language-plaintext highlighter-rouge">ζ</code> ensure that the reduction relation is a congruence for the untyped lambda calculus. The multi-step reduction relation <code class="language-plaintext highlighter-rouge">—↠</code> is also a congruence, which we prove in the following three lemmas.</p><pre class="Agda"><a id="appL-cong"></a><a id="22803" href="/19.08/Untyped/#22803" class="Function">appL-cong</a> <a id="22813" class="Symbol">:</a> <a id="22815" class="Symbol">∀</a> <a id="22817" class="Symbol">{</a><a id="22818" href="plfa.part2.Untyped.html#22818" class="Bound">Γ</a><a id="22819" class="Symbol">}</a> <a id="22821" class="Symbol">{</a><a id="22822" href="plfa.part2.Untyped.html#22822" class="Bound">L</a> <a id="22824" href="plfa.part2.Untyped.html#22824" class="Bound">L&#39;</a> <a id="22827" href="plfa.part2.Untyped.html#22827" class="Bound">M</a> <a id="22829" class="Symbol">:</a> <a id="22831" href="plfa.part2.Untyped.html#22818" class="Bound">Γ</a> <a id="22833" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="22835" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="22836" class="Symbol">}</a>
         <a id="22847" class="Symbol">→</a> <a id="22849" href="/19.08/Untyped/#22822" class="Bound">L</a> <a id="22851" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="22854" href="plfa.part2.Untyped.html#22824" class="Bound">L&#39;</a>
           <a id="22868" class="Comment">---------------</a>
         <a id="22893" class="Symbol">→</a> <a id="22895" href="/19.08/Untyped/#22822" class="Bound">L</a> <a id="22897" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="22899" href="plfa.part2.Untyped.html#22827" class="Bound">M</a> <a id="22901" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="22904" href="plfa.part2.Untyped.html#22824" class="Bound">L&#39;</a> <a id="22907" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="22909" href="plfa.part2.Untyped.html#22827" class="Bound">M</a>
<a id="22911" href="/19.08/Untyped/#22803" class="Function">appL-cong</a> <a id="22921" class="Symbol">{</a><a id="22922" href="plfa.part2.Untyped.html#22922" class="Bound">Γ</a><a id="22923" class="Symbol">}{</a><a id="22925" href="plfa.part2.Untyped.html#22925" class="Bound">L</a><a id="22926" class="Symbol">}{</a><a id="22928" href="plfa.part2.Untyped.html#22928" class="Bound">L&#39;</a><a id="22930" class="Symbol">}{</a><a id="22932" href="plfa.part2.Untyped.html#22932" class="Bound">M</a><a id="22933" class="Symbol">}</a> <a id="22935" class="Symbol">(</a><a id="22936" href="plfa.part2.Untyped.html#22925" class="Bound">L</a> <a id="22938" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a><a id="22939" class="Symbol">)</a> <a id="22941" class="Symbol">=</a> <a id="22943" href="plfa.part2.Untyped.html#22925" class="Bound">L</a> <a id="22945" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="22947" href="plfa.part2.Untyped.html#22932" class="Bound">M</a> <a id="22949" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a>
<a id="22951" href="/19.08/Untyped/#22803" class="Function">appL-cong</a> <a id="22961" class="Symbol">{</a><a id="22962" href="plfa.part2.Untyped.html#22962" class="Bound">Γ</a><a id="22963" class="Symbol">}{</a><a id="22965" href="plfa.part2.Untyped.html#22965" class="Bound">L</a><a id="22966" class="Symbol">}{</a><a id="22968" href="plfa.part2.Untyped.html#22968" class="Bound">L&#39;</a><a id="22970" class="Symbol">}{</a><a id="22972" href="plfa.part2.Untyped.html#22972" class="Bound">M</a><a id="22973" class="Symbol">}</a> <a id="22975" class="Symbol">(</a><a id="22976" href="plfa.part2.Untyped.html#22965" class="Bound">L</a> <a id="22978" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="22982" href="plfa.part2.Untyped.html#22982" class="Bound">r</a> <a id="22984" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="22986" href="plfa.part2.Untyped.html#22986" class="Bound">rs</a><a id="22988" class="Symbol">)</a> <a id="22990" class="Symbol">=</a> <a id="22992" href="plfa.part2.Untyped.html#22965" class="Bound">L</a> <a id="22994" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="22996" href="plfa.part2.Untyped.html#22972" class="Bound">M</a> <a id="22998" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="23002" href="plfa.part2.Untyped.html#10197" class="InductiveConstructor">ξ₁</a> <a id="23005" href="plfa.part2.Untyped.html#22982" class="Bound">r</a> <a id="23007" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="23009" href="plfa.part2.Untyped.html#22803" class="Function">appL-cong</a> <a id="23019" href="plfa.part2.Untyped.html#22986" class="Bound">rs</a>
</pre><p>The proof of <code class="language-plaintext highlighter-rouge">appL-cong</code> is by induction on the reduction sequence <code class="language-plaintext highlighter-rouge">L —↠ L'</code>.</p><ul><li>Suppose <code class="language-plaintext highlighter-rouge">L —↠ L</code> by <code class="language-plaintext highlighter-rouge">L ∎</code>. Then we have <code class="language-plaintext highlighter-rouge">L · M —↠ L · M</code> by <code class="language-plaintext highlighter-rouge">L · M ∎</code>.</li><li>Suppose <code class="language-plaintext highlighter-rouge">L —↠ L''</code> by <code class="language-plaintext highlighter-rouge">L —→⟨ r ⟩ rs</code>, so <code class="language-plaintext highlighter-rouge">L —→ L'</code> by <code class="language-plaintext highlighter-rouge">r</code> and <code class="language-plaintext highlighter-rouge">L' —↠ L''</code> by <code class="language-plaintext highlighter-rouge">rs</code>. We have <code class="language-plaintext highlighter-rouge">L · M —→ L' · M</code> by <code class="language-plaintext highlighter-rouge">ξ₁ r</code> and <code class="language-plaintext highlighter-rouge">L' · M —↠ L'' · M</code> by the induction hypothesis applied to <code class="language-plaintext highlighter-rouge">rs</code>. We conclude that <code class="language-plaintext highlighter-rouge">L · M —↠ L'' · M</code> by putting these two facts together using <code class="language-plaintext highlighter-rouge">_—→⟨_⟩_</code>.</li></ul><p>The proofs of <code class="language-plaintext highlighter-rouge">appR-cong</code> and <code class="language-plaintext highlighter-rouge">abs-cong</code> follow the same pattern as the proof for <code class="language-plaintext highlighter-rouge">appL-cong</code>.</p><pre class="Agda"><a id="appR-cong"></a><a id="23572" href="/19.08/Untyped/#23572" class="Function">appR-cong</a> <a id="23582" class="Symbol">:</a> <a id="23584" class="Symbol">∀</a> <a id="23586" class="Symbol">{</a><a id="23587" href="plfa.part2.Untyped.html#23587" class="Bound">Γ</a><a id="23588" class="Symbol">}</a> <a id="23590" class="Symbol">{</a><a id="23591" href="plfa.part2.Untyped.html#23591" class="Bound">L</a> <a id="23593" href="plfa.part2.Untyped.html#23593" class="Bound">M</a> <a id="23595" href="plfa.part2.Untyped.html#23595" class="Bound">M&#39;</a> <a id="23598" class="Symbol">:</a> <a id="23600" href="plfa.part2.Untyped.html#23587" class="Bound">Γ</a> <a id="23602" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="23604" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="23605" class="Symbol">}</a>
         <a id="23616" class="Symbol">→</a> <a id="23618" href="/19.08/Untyped/#23593" class="Bound">M</a> <a id="23620" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="23623" href="plfa.part2.Untyped.html#23595" class="Bound">M&#39;</a>
           <a id="23637" class="Comment">---------------</a>
         <a id="23662" class="Symbol">→</a> <a id="23664" href="/19.08/Untyped/#23591" class="Bound">L</a> <a id="23666" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="23668" href="plfa.part2.Untyped.html#23593" class="Bound">M</a> <a id="23670" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="23673" href="plfa.part2.Untyped.html#23591" class="Bound">L</a> <a id="23675" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="23677" href="plfa.part2.Untyped.html#23595" class="Bound">M&#39;</a>
<a id="23680" href="/19.08/Untyped/#23572" class="Function">appR-cong</a> <a id="23690" class="Symbol">{</a><a id="23691" href="plfa.part2.Untyped.html#23691" class="Bound">Γ</a><a id="23692" class="Symbol">}{</a><a id="23694" href="plfa.part2.Untyped.html#23694" class="Bound">L</a><a id="23695" class="Symbol">}{</a><a id="23697" href="plfa.part2.Untyped.html#23697" class="Bound">M</a><a id="23698" class="Symbol">}{</a><a id="23700" href="plfa.part2.Untyped.html#23700" class="Bound">M&#39;</a><a id="23702" class="Symbol">}</a> <a id="23704" class="Symbol">(</a><a id="23705" href="plfa.part2.Untyped.html#23697" class="Bound">M</a> <a id="23707" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a><a id="23708" class="Symbol">)</a> <a id="23710" class="Symbol">=</a> <a id="23712" href="plfa.part2.Untyped.html#23694" class="Bound">L</a> <a id="23714" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="23716" href="plfa.part2.Untyped.html#23697" class="Bound">M</a> <a id="23718" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a>
<a id="23720" href="/19.08/Untyped/#23572" class="Function">appR-cong</a> <a id="23730" class="Symbol">{</a><a id="23731" href="plfa.part2.Untyped.html#23731" class="Bound">Γ</a><a id="23732" class="Symbol">}{</a><a id="23734" href="plfa.part2.Untyped.html#23734" class="Bound">L</a><a id="23735" class="Symbol">}{</a><a id="23737" href="plfa.part2.Untyped.html#23737" class="Bound">M</a><a id="23738" class="Symbol">}{</a><a id="23740" href="plfa.part2.Untyped.html#23740" class="Bound">M&#39;</a><a id="23742" class="Symbol">}</a> <a id="23744" class="Symbol">(</a><a id="23745" href="plfa.part2.Untyped.html#23737" class="Bound">M</a> <a id="23747" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="23751" href="plfa.part2.Untyped.html#23751" class="Bound">r</a> <a id="23753" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="23755" href="plfa.part2.Untyped.html#23755" class="Bound">rs</a><a id="23757" class="Symbol">)</a> <a id="23759" class="Symbol">=</a> <a id="23761" href="plfa.part2.Untyped.html#23734" class="Bound">L</a> <a id="23763" href="plfa.part2.Untyped.html#4442" class="InductiveConstructor Operator">·</a> <a id="23765" href="plfa.part2.Untyped.html#23737" class="Bound">M</a> <a id="23767" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="23771" href="plfa.part2.Untyped.html#10287" class="InductiveConstructor">ξ₂</a> <a id="23774" href="plfa.part2.Untyped.html#23751" class="Bound">r</a> <a id="23776" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="23778" href="plfa.part2.Untyped.html#23572" class="Function">appR-cong</a> <a id="23788" href="plfa.part2.Untyped.html#23755" class="Bound">rs</a>
</pre><pre class="Agda"><a id="abs-cong"></a><a id="23800" href="/19.08/Untyped/#23800" class="Function">abs-cong</a> <a id="23809" class="Symbol">:</a> <a id="23811" class="Symbol">∀</a> <a id="23813" class="Symbol">{</a><a id="23814" href="plfa.part2.Untyped.html#23814" class="Bound">Γ</a><a id="23815" class="Symbol">}</a> <a id="23817" class="Symbol">{</a><a id="23818" href="plfa.part2.Untyped.html#23818" class="Bound">N</a> <a id="23820" href="plfa.part2.Untyped.html#23820" class="Bound">N&#39;</a> <a id="23823" class="Symbol">:</a> <a id="23825" href="plfa.part2.Untyped.html#23814" class="Bound">Γ</a> <a id="23827" href="plfa.part2.Untyped.html#3191" class="InductiveConstructor Operator">,</a> <a id="23829" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a> <a id="23831" href="plfa.part2.Untyped.html#4294" class="Datatype Operator">⊢</a> <a id="23833" href="plfa.part2.Untyped.html#2888" class="InductiveConstructor">★</a><a id="23834" class="Symbol">}</a>
         <a id="23845" class="Symbol">→</a> <a id="23847" href="/19.08/Untyped/#23818" class="Bound">N</a> <a id="23849" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="23852" href="plfa.part2.Untyped.html#23820" class="Bound">N&#39;</a>
           <a id="23866" class="Comment">----------</a>
         <a id="23886" class="Symbol">→</a> <a id="23888" href="/19.08/Untyped/#4382" class="InductiveConstructor Operator">ƛ</a> <a id="23890" href="plfa.part2.Untyped.html#23818" class="Bound">N</a> <a id="23892" href="plfa.part2.Untyped.html#11267" class="Datatype Operator">—↠</a> <a id="23895" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="23897" href="plfa.part2.Untyped.html#23820" class="Bound">N&#39;</a>
<a id="23900" href="/19.08/Untyped/#23800" class="Function">abs-cong</a> <a id="23909" class="Symbol">(</a><a id="23910" href="plfa.part2.Untyped.html#23910" class="Bound">M</a> <a id="23912" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a><a id="23913" class="Symbol">)</a> <a id="23915" class="Symbol">=</a> <a id="23917" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="23919" href="plfa.part2.Untyped.html#23910" class="Bound">M</a> <a id="23921" href="plfa.part2.Untyped.html#11317" class="InductiveConstructor Operator">∎</a>
<a id="23923" href="/19.08/Untyped/#23800" class="Function">abs-cong</a> <a id="23932" class="Symbol">(</a><a id="23933" href="plfa.part2.Untyped.html#23933" class="Bound">L</a> <a id="23935" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="23939" href="plfa.part2.Untyped.html#23939" class="Bound">r</a> <a id="23941" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="23943" href="plfa.part2.Untyped.html#23943" class="Bound">rs</a><a id="23945" class="Symbol">)</a> <a id="23947" class="Symbol">=</a> <a id="23949" href="plfa.part2.Untyped.html#4382" class="InductiveConstructor Operator">ƛ</a> <a id="23951" href="plfa.part2.Untyped.html#23933" class="Bound">L</a> <a id="23953" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">—→⟨</a> <a id="23957" href="plfa.part2.Untyped.html#10485" class="InductiveConstructor">ζ</a> <a id="23959" href="plfa.part2.Untyped.html#23939" class="Bound">r</a> <a id="23961" href="plfa.part2.Untyped.html#11373" class="InductiveConstructor Operator">⟩</a> <a id="23963" href="plfa.part2.Untyped.html#23800" class="Function">abs-cong</a> <a id="23972" href="plfa.part2.Untyped.html#23943" class="Bound">rs</a>
</pre><h2 id="unicode">Unicode</h2><p>This chapter uses the following unicode:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>★  U+2605  BLACK STAR (\st)
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">\st</code> command permits navigation among many different stars; the one we use is number 7.</p></div><p style="text-align:center"><a alt="Previous chapter" href="/19.08/Inference/">Prev</a> &bullet; <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev-19.08/src/plfa/part2/Untyped.lagda.md">Source</a> &bullet; <a alt="Next chapter" href="/19.08/Confluence/">Next</a></p></article></div></main><footer class="site-footer h-card"><data class="u-url" href="/19.08/"></data><div class="wrapper"><h2 class="footer-heading">Programming Language Foundations in Agda</h2><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Philip Wadler</li><li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/19.08/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul></div><div class="footer-col footer-col-3"></div></div><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Wen Kokke</li><li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/19.08/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/19.08/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul></div><div class="footer-col footer-col-3"></div></div><div class="footer-col-wrapper"><div class="footer-col footer-col-1"><ul class="contact-list"><li class="p-name">Jeremy Siek</li><li><a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a></li></ul></div><div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jsiek"><svg class="svg-icon"><use xlink:href="/19.08/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jsiek</span></a></li><li><a href="https://www.twitter.com/jeremysiek"><svg class="svg-icon"><use xlink:href="/19.08/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jeremysiek</span></a></li></ul></div><div class="footer-col footer-col-3"></div></div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></div></footer><script type="text/javascript" src="/19.08/assets/jquery.js"></script><script type="text/javascript">$(".menu-icon").click(function(){$(".trigger").toggle()}),$("div.foldable pre").each(function(){var i=$(this).height(),t=parseFloat($(this).css("line-height")),h=$("<div></div>"),e=$("<div></div>"),o=$("<div></div>");$(this).prepend(h),h.css({position:"relative",float:"right",right:"-"+(.5*t-1.5)+"px",width:t,height:t}),o.css({position:"relative",height:t,width:"3px","background-color":"#C1E0FF"}),e.css({position:"relative",top:"-"+(.5*t+1.5)+"px",left:"-"+(.5*t-1.5)+"px",height:"3px",width:t,"background-color":"#C1E0FF"}),h.append(o),h.append(e),$(this).height(2*t),$(this).css("overflow","hidden"),$(this).click(function(){$(this).height()==i?($(this).height(2*t),h.show()):($(this).height("auto"),h.hide())})})</script><script type="text/javascript" src="/19.08/assets/katex.js"></script><script type="text/javascript">$("script[type='math/tex']").replaceWith(function(){var t=$(this).text();return'<span class="inline-equation">'+katex.renderToString(t)+"</span>"}),$("script[type='math/tex; mode=display']").replaceWith(function(){var t=$(this).text().replace(/%.*?(\n|$)/g,"");return'<div class="equation">'+katex.renderToString("\\displaystyle "+t)+"</div>"})</script></body></html>